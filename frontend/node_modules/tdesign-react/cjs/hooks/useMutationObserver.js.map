{"version":3,"file":"useMutationObserver.js","sources":["../../../components/hooks/useMutationObserver.ts"],"sourcesContent":["import { useRef, useEffect } from 'react';\nimport { debounce, isEqual } from 'lodash-es';\nimport useLatest from './useLatest';\n\nconst DEFAULT_OPTIONS = {\n  debounceTime: 0,\n  config: {\n    attributes: true,\n    childList: true,\n    characterData: true,\n    subtree: true,\n  } as MutationObserverInit,\n};\n\ntype Options = typeof DEFAULT_OPTIONS;\n\nexport default function useMutationObservable(\n  targetEl: HTMLElement | null,\n  cb: MutationCallback,\n  options = DEFAULT_OPTIONS,\n) {\n  const optionsRef = useRef<Options>(null);\n  const signalRef = useRef(0);\n  const callbackRef = useLatest(cb);\n\n  if (!isEqual(options, optionsRef.current)) {\n    signalRef.current += 1;\n  }\n\n  optionsRef.current = options;\n\n  useEffect(() => {\n    if (!targetEl || !targetEl?.nodeType) return;\n    let observer: MutationObserver = null;\n    try {\n      const { debounceTime, config } = optionsRef.current;\n      const mutationCallback: MutationCallback = (...args) => {\n        callbackRef.current(...args);\n      };\n      observer = new MutationObserver(debounceTime > 0 ? debounce(mutationCallback, debounceTime) : mutationCallback);\n      observer.observe(targetEl, config);\n    } catch (e) {\n      console.error(e);\n    }\n\n    return () => {\n      if (observer) {\n        observer.disconnect();\n        observer = null;\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [targetEl, signalRef.current]);\n}\n"],"names":["DEFAULT_OPTIONS","debounceTime","config","attributes","childList","characterData","subtree","useMutationObservable","targetEl","cb","options","arguments","length","undefined","optionsRef","useRef","signalRef","callbackRef","useLatest","isEqual","current","useEffect","nodeType","observer","_optionsRef$current","mutationCallback","apply","MutationObserver","debounce","observe","e","console","error","disconnect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,IAAMA,eAAkB,GAAA;AACtBC,EAAAA,YAAc,EAAA,CAAA;AACdC,EAAAA,MAAQ,EAAA;AACNC,IAAAA,UAAY,EAAA,IAAA;AACZC,IAAAA,SAAW,EAAA,IAAA;AACXC,IAAAA,aAAe,EAAA,IAAA;AACfC,IAAAA,OAAS,EAAA,IAAA;AACX,GAAA;AACF,CAAA,CAAA;AAIA,SAAwBC,qBACtBA,CAAAC,QAAA,EACAC,EACA,EACA;AAAA,EAAA,IADAC,OAAA,GAAAC,SAAA,CAAAC,MAAA,GAAA,CAAA,IAAAD,SAAA,CAAA,CAAA,CAAA,KAAAE,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAUX,eACV,CAAA;AACM,EAAA,IAAAc,UAAA,GAAaC,aAAgB,IAAI,CAAA,CAAA;AACjC,EAAA,IAAAC,SAAA,GAAYD,aAAO,CAAC,CAAA,CAAA;AACpB,EAAA,IAAAE,WAAA,GAAcC,2BAAUT,EAAE,CAAA,CAAA;EAEhC,IAAI,CAACU,eAAA,CAAQT,OAAS,EAAAI,UAAA,CAAWM,OAAO,CAAG,EAAA;IACzCJ,SAAA,CAAUI,OAAW,IAAA,CAAA,CAAA;AACvB,GAAA;EAEAN,UAAA,CAAWM,OAAU,GAAAV,OAAA,CAAA;AAErBW,EAAAA,eAAA,CAAU,YAAM;IACV,IAAA,CAACb,QAAY,IAAA,EAACA,QAAU,KAAVA,IAAAA,IAAAA,QAAU,KAAVA,KAAAA,CAAAA,IAAAA,QAAU,CAAAc,QAAA,CAAU,EAAA,OAAA;IACtC,IAAIC,QAA6B,GAAA,IAAA,CAAA;IAC7B,IAAA;AACF,MAAA,IAAAC,mBAAA,GAAiCV,UAAW,CAAAM,OAAA;QAApCnB,YAAA,GAAAuB,mBAAA,CAAAvB,YAAA;QAAcC,MAAO,GAAAsB,mBAAA,CAAPtB,MAAO,CAAA;AACvB,MAAA,IAAAuB,gBAAA,GAAqC,SAArCA,gBAAAA,GAAkD;QAC1CR,WAAA,CAAAG,OAAA,CAAAM,KAAA,CAAAT,WAAA,EAAAN,SAAe,CAAA,CAAA;OAC7B,CAAA;AACWY,MAAAA,QAAA,GAAA,IAAII,iBAAiB1B,YAAe,GAAA,CAAA,GAAI2B,kBAASH,gBAAkB,EAAAxB,YAAY,IAAIwB,gBAAgB,CAAA,CAAA;AACrGF,MAAAA,QAAA,CAAAM,OAAA,CAAQrB,UAAUN,MAAM,CAAA,CAAA;aAC1B4B,CAAP,EAAA;AACAC,MAAAA,OAAA,CAAQC,MAAMF,CAAC,CAAA,CAAA;AACjB,KAAA;AAEA,IAAA,OAAO,YAAM;AACX,MAAA,IAAIP,QAAU,EAAA;QACZA,QAAA,CAASU,UAAW,EAAA,CAAA;AACTV,QAAAA,QAAA,GAAA,IAAA,CAAA;AACb,OAAA;KACF,CAAA;GAEC,EAAA,CAACf,QAAU,EAAAQ,SAAA,CAAUI,OAAO,CAAC,CAAA,CAAA;AAClC;;;;"}