{"version":3,"file":"TimePicker.js","sources":["../../../components/time-picker/TimePicker.tsx"],"sourcesContent":["import React, { useState, Ref } from 'react';\nimport classNames from 'classnames';\nimport dayjs from 'dayjs';\nimport customParseFormat from 'dayjs/plugin/customParseFormat';\nimport { TimeIcon as TdTimeIcon } from 'tdesign-icons-react';\n\nimport { formatInputValue, validateInputValue } from '@tdesign/common-js/time-picker/utils';\nimport { DEFAULT_STEPS, DEFAULT_FORMAT } from '@tdesign/common-js/time-picker/const';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport noop from '../_util/noop';\n\nimport SelectInput from '../select-input';\nimport type { SelectInputProps, SelectInputValueChangeContext } from '../select-input';\nimport TimeRangePicker from './TimeRangePicker';\nimport TimePickerPanel from './panel/TimePickerPanel';\nimport type { TimePickerPanelProps } from './panel/TimePickerPanel';\n\nimport { useTimePickerTextConfig } from './hooks/useTimePickerTextConfig';\nimport { timePickerDefaultProps } from './defaultProps';\n\nimport type { StyledProps } from '../common';\nimport type { TdTimePickerProps } from './type';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\n// https://github.com/iamkun/dayjs/issues/1552\ndayjs.extend(customParseFormat);\n\nexport interface TimePickerProps extends TdTimePickerProps, StyledProps {}\n\nconst TimePicker = forwardRefWithStatics(\n  (originalProps: TimePickerProps, ref: Ref<HTMLDivElement>) => {\n    const props = useDefaultProps<TimePickerProps>(originalProps, timePickerDefaultProps);\n    const TEXT_CONFIG = useTimePickerTextConfig();\n    const {\n      allowInput,\n      borderless,\n      className,\n      clearable,\n      disabled,\n      style,\n      format = DEFAULT_FORMAT,\n      hideDisabledTime = true,\n      steps = DEFAULT_STEPS,\n      placeholder = TEXT_CONFIG.placeholder,\n      disableTime,\n      onBlur = noop,\n      onClose = noop,\n      onFocus = noop,\n      onOpen = noop,\n      onInput = noop,\n      onPick = noop,\n      onClear = noop,\n    } = props;\n\n    const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n    const [isPanelShowed, setPanelShow] = useState(false);\n    const [currentValue, setCurrentValue] = useState('');\n\n    const { classPrefix } = useConfig();\n    const { TimeIcon } = useGlobalIcon({\n      TimeIcon: TdTimeIcon,\n    });\n    const name = `${classPrefix}-time-picker`;\n    const inputClasses = classNames(`${name}__group`, {\n      [`${classPrefix}-is-focused`]: isPanelShowed,\n    });\n\n    const effectVisibleCurrentValue = (visible: boolean) => {\n      setPanelShow(visible);\n      setCurrentValue(visible ? value ?? '' : '');\n    };\n\n    const handleShowPopup = (visible: boolean, context: { e: React.MouseEvent<HTMLDivElement, MouseEvent> }) => {\n      effectVisibleCurrentValue(visible);\n      visible ? onOpen(context) : onClose(context); // trigger on-open and on-close\n    };\n\n    const handleClear = (context: { e: React.MouseEvent<SVGSVGElement> }) => {\n      const { e } = context;\n      e.stopPropagation();\n      setCurrentValue('');\n      onChange(null);\n      onClear(context);\n    };\n\n    const handleInputChange = (value: string, context: SelectInputValueChangeContext) => {\n      setCurrentValue(value);\n      if (allowInput) {\n        onInput({ value, e: context.e as React.FocusEvent<HTMLInputElement> });\n      }\n    };\n\n    const handleInputBlur: SelectInputProps['onBlur'] = (value, ctx) => {\n      if (allowInput) {\n        const isValidTime = validateInputValue(currentValue, format);\n        if (isValidTime) {\n          onChange(formatInputValue(currentValue, format));\n        }\n      }\n      onBlur({ value: String(value), ...ctx });\n    };\n\n    const handleClickConfirm = () => {\n      const isValidTime = validateInputValue(currentValue, format);\n      if (isValidTime) onChange(currentValue);\n      effectVisibleCurrentValue(false);\n    };\n\n    const handlePanelChange: TimePickerPanelProps['onChange'] = (v, ctx) => {\n      setCurrentValue(v);\n      onPick?.(v, ctx);\n    };\n\n    return (\n      <div className={classNames(name, className)} ref={ref} style={style}>\n        <SelectInput\n          onFocus={onFocus}\n          onClear={handleClear}\n          disabled={disabled}\n          clearable={clearable}\n          allowInput={allowInput}\n          className={inputClasses}\n          borderless={borderless}\n          suffixIcon={<TimeIcon />}\n          popupVisible={isPanelShowed}\n          onInputChange={handleInputChange}\n          onBlur={handleInputBlur}\n          onPopupVisibleChange={handleShowPopup}\n          placeholder={!value ? placeholder : undefined}\n          value={isPanelShowed ? currentValue : value ?? undefined}\n          inputValue={isPanelShowed ? currentValue : value ?? undefined}\n          inputProps={{ ...props.inputProps, size: props.size }}\n          popupProps={{ overlayInnerStyle: { width: 'auto', padding: 0 }, ...props.popupProps }}\n          tips={props.tips}\n          status={props.status}\n          label={props.label}\n          panel={\n            <TimePickerPanel\n              steps={steps}\n              format={format}\n              value={currentValue}\n              isFooterDisplay={true}\n              isShowPanel={isPanelShowed}\n              disableTime={disableTime}\n              onChange={handlePanelChange}\n              onPick={props.onPick}\n              hideDisabledTime={hideDisabledTime}\n              handleConfirmClick={handleClickConfirm}\n              presets={props.presets}\n            />\n          }\n        />\n      </div>\n    );\n  },\n  {\n    TimeRangePicker,\n    TimePickerPanel,\n  },\n);\n\nTimePicker.displayName = 'TimePicker';\n\nexport default TimePicker;\n"],"names":["dayjs","extend","customParseFormat","TimePicker","forwardRefWithStatics","originalProps","ref","props","useDefaultProps","timePickerDefaultProps","TEXT_CONFIG","useTimePickerTextConfig","allowInput","borderless","className","clearable","disabled","style","_props$format","format","DEFAULT_FORMAT","_props$hideDisabledTi","hideDisabledTime","_props$steps","steps","DEFAULT_STEPS","_props$placeholder","placeholder","disableTime","_props$onBlur","onBlur","noop","_props$onClose","onClose","_props$onFocus","onFocus","_props$onOpen","onOpen","_props$onInput","onInput","_props$onPick","onPick","_props$onClear","onClear","_useControlled","useControlled","onChange","_useControlled2","_slicedToArray","value","_useState","useState","_useState2","isPanelShowed","setPanelShow","_useState3","_useState4","currentValue","setCurrentValue","_useConfig","useConfig","classPrefix","_useGlobalIcon","useGlobalIcon","TimeIcon","TdTimeIcon","name","inputClasses","classNames","concat","_defineProperty","effectVisibleCurrentValue","visible","handleShowPopup","context","handleClear","e","stopPropagation","handleInputChange","handleInputBlur","ctx","isValidTime","validateInputValue","formatInputValue","_objectSpread","String","handleClickConfirm","handlePanelChange","v","React","createElement","SelectInput","suffixIcon","popupVisible","onInputChange","onPopupVisibleChange","inputValue","inputProps","size","popupProps","overlayInnerStyle","width","padding","tips","status","label","panel","TimePickerPanel","isFooterDisplay","isShowPanel","handleConfirmClick","presets","TimeRangePicker","displayName"],"mappings":"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"}