{"version":3,"file":"List.js","sources":["../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/compact.js","../../../components/list/List.tsx"],"sourcesContent":["/**\n * Creates an array with all falsey values removed. The values `false`, `null`,\n * `0`, `\"\"`, `undefined`, and `NaN` are falsey.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to compact.\n * @returns {Array} Returns the new array of filtered values.\n * @example\n *\n * _.compact([0, 1, false, 2, '', 3]);\n * // => [1, 2, 3]\n */\nfunction compact(array) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      resIndex = 0,\n      result = [];\n\n  while (++index < length) {\n    var value = array[index];\n    if (value) {\n      result[resIndex++] = value;\n    }\n  }\n  return result;\n}\n\nexport default compact;\n","import React, { MouseEvent, useImperativeHandle, useMemo, useRef, WheelEvent } from 'react';\nimport classNames from 'classnames';\nimport { compact, isString } from 'lodash-es';\nimport useConfig from '../hooks/useConfig';\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport noop from '../_util/noop';\nimport { TdListProps } from './type';\nimport { ComponentScrollToElementParams, StyledProps } from '../common';\nimport Loading from '../loading';\nimport ListItem from './ListItem';\nimport ListItemMeta from './ListItemMeta';\nimport { listDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport { useListVirtualScroll } from './hooks/useListVirtualScroll';\nimport parseTNode from '../_util/parseTNode';\n\nexport interface ListProps extends TdListProps, StyledProps {\n  /**\n   * 文本内容\n   */\n  children?: React.ReactNode;\n}\n\nexport type ListRef = {\n  scrollTo: (params: ComponentScrollToElementParams) => void;\n};\n\n/**\n * 列表组件\n */\nconst List = forwardRefWithStatics(\n  (props: ListProps, ref: React.Ref<ListRef>) => {\n    const {\n      header,\n      footer,\n      asyncLoading,\n      size,\n      split,\n      stripe,\n      layout,\n      children,\n      className,\n      onLoadMore = noop,\n      onScroll = noop,\n      style,\n      scroll,\n    } = useDefaultProps<ListProps>(props, listDefaultProps);\n    const wrapperRef = useRef<HTMLDivElement>(null);\n\n    const { classPrefix } = useConfig();\n    const [local, t] = useLocaleReceiver('list');\n\n    const listItems = useMemo(\n      () => compact(React.Children.map(children, (child: React.ReactElement) => child?.props)) ?? [],\n      [children],\n    );\n\n    const { virtualConfig, cursorStyle, listStyle, isVirtualScroll, onInnerVirtualScroll, scrollToElement } =\n      useListVirtualScroll(scroll, wrapperRef, listItems);\n\n    const COMPONENT_NAME = `${classPrefix}-list`;\n\n    const handleClickLoad = (e: MouseEvent<HTMLDivElement>) => {\n      if (asyncLoading === 'load-more') {\n        onLoadMore({ e });\n      }\n    };\n\n    const handleScroll = (event: WheelEvent<HTMLDivElement>): void => {\n      const { currentTarget } = event;\n      const { scrollTop, offsetHeight, scrollHeight } = currentTarget;\n      const scrollBottom = scrollHeight - scrollTop - offsetHeight;\n      if (isVirtualScroll) onInnerVirtualScroll(event as unknown as globalThis.WheelEvent);\n      onScroll({ e: event, scrollTop, scrollBottom });\n    };\n\n    const loadElement = isString(asyncLoading) ? (\n      <div\n        className={classNames(`${classPrefix}-list__load`, {\n          [`${classPrefix}-list__load--loading`]: asyncLoading === 'loading',\n          [`${classPrefix}-list__load--load-more`]: asyncLoading === 'load-more',\n        })}\n        onClick={handleClickLoad}\n      >\n        {asyncLoading === 'loading' && (\n          <div>\n            <Loading loading={true} />\n            <span>{t(local.loadingText)}</span>\n          </div>\n        )}\n        {asyncLoading === 'load-more' && <span>{t(local.loadingMoreText)}</span>}\n      </div>\n    ) : (\n      asyncLoading\n    );\n\n    useImperativeHandle(ref, () => ({\n      scrollTo: scrollToElement,\n    }));\n\n    const renderContent = () => (\n      <>\n        {isVirtualScroll ? (\n          <>\n            <div style={cursorStyle}></div>\n            <ul className={`${COMPONENT_NAME}__inner`} style={listStyle}>\n              {virtualConfig.visibleData.map((item, index) => (\n                <ListItem key={index} content={item.children}></ListItem>\n              ))}\n            </ul>\n          </>\n        ) : (\n          <ul className={`${COMPONENT_NAME}__inner`}>{children}</ul>\n        )}\n      </>\n    );\n\n    return (\n      <div\n        ref={wrapperRef}\n        style={{\n          ...style,\n          position: isVirtualScroll ? 'relative' : undefined,\n        }}\n        onScroll={handleScroll}\n        className={classNames(`${COMPONENT_NAME}`, className, {\n          [`${COMPONENT_NAME}--split`]: split,\n          [`${COMPONENT_NAME}--stripe`]: stripe,\n          [`${COMPONENT_NAME}--vertical-action`]: layout === 'vertical',\n          [`${classPrefix}-size-s`]: size === 'small',\n          [`${classPrefix}-size-l`]: size === 'large',\n        })}\n      >\n        {header && <div className={`${COMPONENT_NAME}__header`}>{parseTNode(header)}</div>}\n        {renderContent()}\n        {asyncLoading && loadElement}\n        {footer && <div className={`${COMPONENT_NAME}__footer`}>{parseTNode(footer)}</div>}\n      </div>\n    );\n  },\n  { ListItem, ListItemMeta },\n);\n\nList.displayName = 'List';\n\nexport default List;\n"],"names":["compact","array","index","length","resIndex","result","value","List","forwardRefWithStatics","props","ref","_useDefaultProps","useDefaultProps","listDefaultProps","header","footer","asyncLoading","size","split","stripe","layout","children","className","_useDefaultProps$onLo","onLoadMore","noop","_useDefaultProps$onSc","onScroll","style","scroll","wrapperRef","useRef","_useConfig","useConfig","classPrefix","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","_slicedToArray","local","t","listItems","useMemo","_compact","React","Children","map","child","_useListVirtualScroll","useListVirtualScroll","virtualConfig","cursorStyle","listStyle","isVirtualScroll","onInnerVirtualScroll","scrollToElement","COMPONENT_NAME","handleClickLoad","e","handleScroll","event","currentTarget","scrollTop","offsetHeight","scrollHeight","scrollBottom","loadElement","isString","createElement","classNames","concat","_defineProperty","onClick","Loading","loading","loadingText","loadingMoreText","useImperativeHandle","scrollTo","renderContent","Fragment","visibleData","item","ListItem","key","content","_objectSpread","position","parseTNode","ListItemMeta","displayName"],"mappings":"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"}