{"version":3,"file":"useTagScroll.js","sources":["../../../components/tag-input/useTagScroll.ts"],"sourcesContent":["/**\n * 当标签数量过多时，输入框显示不下，则需要滚动查看，以下为滚动逻辑\n * 如果标签过多时的处理方式，是标签省略，则不需要此功能\n */\n\nimport { isFunction } from 'lodash-es';\nimport { useRef, useEffect, useState, WheelEvent } from 'react';\nimport { TdTagInputProps } from './type';\n\nlet mouseEnterTimer = null;\n\nexport default function useTagScroll(props: TdTagInputProps) {\n  const tagInputRef = useRef<{ currentElement: HTMLDivElement }>(null);\n  const { excessTagsDisplayType = 'scroll', readonly, disabled } = props;\n  // 允许向右滚动的最大距离\n  const [scrollDistance, setScrollDistance] = useState(0);\n  const [scrollElement, setScrollElement] = useState<HTMLDivElement>();\n\n  const updateScrollElement = (element: HTMLDivElement) => {\n    const scrollElement = element.children[0] as HTMLDivElement;\n    setScrollElement(scrollElement);\n  };\n\n  const updateScrollDistance = () => {\n    if (!scrollElement) return;\n    setScrollDistance(scrollElement.scrollWidth - scrollElement.clientWidth);\n  };\n\n  const scrollTo = (distance: number) => {\n    if (isFunction(scrollElement?.scroll)) {\n      scrollElement.scroll({ left: distance, behavior: 'smooth' });\n    }\n  };\n\n  const scrollToRight = () => {\n    updateScrollDistance();\n    scrollTo(scrollDistance);\n  };\n\n  const scrollToLeft = () => {\n    scrollTo(0);\n  };\n\n  // TODO：MAC 电脑横向滚动，Windows 纵向滚动。当前只处理了横向滚动\n  const onWheel = ({ e }: { e: WheelEvent<HTMLDivElement> }) => {\n    if (readonly || disabled) return;\n    if (!scrollElement) return;\n    if (e.deltaX > 0) {\n      const distance = Math.min(scrollElement.scrollLeft + 120, scrollDistance);\n      scrollTo(distance);\n    } else {\n      const distance = Math.max(scrollElement.scrollLeft - 120, 0);\n      scrollTo(distance);\n    }\n  };\n\n  // 鼠标 hover，自动滑动到最右侧，以便输入新标签\n  const scrollToRightOnEnter = () => {\n    if (excessTagsDisplayType !== 'scroll') return;\n    // 一闪而过的 mousenter 不需要执行\n    mouseEnterTimer = setTimeout(() => {\n      scrollToRight();\n      clearTimeout(mouseEnterTimer);\n    }, 100);\n  };\n\n  const scrollToLeftOnLeave = () => {\n    if (excessTagsDisplayType !== 'scroll') return;\n    scrollTo(0);\n    clearTimeout(mouseEnterTimer);\n  };\n\n  const clearScroll = () => {\n    clearTimeout(mouseEnterTimer);\n  };\n\n  const initScroll = (element: HTMLDivElement) => {\n    if (!element) return;\n    updateScrollElement(element);\n  };\n\n  useEffect(() => {\n    initScroll(tagInputRef?.current?.currentElement);\n    return clearScroll;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return {\n    initScroll,\n    clearScroll,\n    tagInputRef,\n    scrollElement,\n    scrollDistance,\n    scrollTo,\n    scrollToRight,\n    scrollToLeft,\n    updateScrollElement,\n    updateScrollDistance,\n    onWheel,\n    scrollToRightOnEnter,\n    scrollToLeftOnLeave,\n  };\n}\n"],"names":["mouseEnterTimer","useTagScroll","props","tagInputRef","useRef","_props$excessTagsDisp","excessTagsDisplayType","readonly","disabled","_useState","useState","_useState2","_slicedToArray","scrollDistance","setScrollDistance","_useState3","_useState4","scrollElement","setScrollElement","updateScrollElement","element","children","updateScrollDistance","scrollWidth","clientWidth","scrollTo","distance","isFunction","scroll","left","behavior","scrollToRight","scrollToLeft","onWheel","_ref","e","deltaX","Math","min","scrollLeft","max","scrollToRightOnEnter","setTimeout","clearTimeout","scrollToLeftOnLeave","clearScroll","initScroll","useEffect","_tagInputRef$current","current","currentElement"],"mappings":"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"}