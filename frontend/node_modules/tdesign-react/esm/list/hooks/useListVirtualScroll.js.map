{"version":3,"file":"useListVirtualScroll.js","sources":["../../../../components/list/hooks/useListVirtualScroll.ts"],"sourcesContent":["import React, { useMemo } from 'react';\nimport log from '@tdesign/common-js/log/index';\nimport useVirtualScroll from '../../hooks/useVirtualScroll';\nimport { TdListProps } from '../type';\nimport { Styles, type ComponentScrollToElementParams } from '../../common';\n\nexport const useListVirtualScroll = (\n  scroll: TdListProps['scroll'],\n  listRef: React.MutableRefObject<HTMLElement>,\n  listItems: any[],\n) => {\n  const virtualScrollParams = useMemo(\n    () => ({\n      data: listItems,\n      scroll,\n    }),\n    [listItems, scroll],\n  );\n  const virtualConfig = useVirtualScroll(listRef, virtualScrollParams);\n  const { isVirtualScroll } = virtualConfig;\n  let lastScrollY = -1;\n\n  const onInnerVirtualScroll = (e: WheelEvent) => {\n    const target = (e.target || e.srcElement) as HTMLElement;\n    const top = target.scrollTop;\n    if (lastScrollY !== top) {\n      virtualConfig.isVirtualScroll && virtualConfig.handleScroll();\n    } else {\n      lastScrollY = -1;\n    }\n    lastScrollY = top;\n  };\n\n  const cursorStyle = useMemo(\n    () =>\n      ({\n        position: 'absolute',\n        width: '1px',\n        height: '1px',\n        transition: 'transform 0.2s',\n        transform: `translate(0, ${virtualConfig.scrollHeight}px)`,\n        msTransform: `translate(0, ${virtualConfig.scrollHeight}px)`,\n        MozTransform: `translate(0, ${virtualConfig.scrollHeight}px)`,\n        WebkitTransform: `translate(0, ${virtualConfig.scrollHeight}px)`,\n      } as Styles),\n    [virtualConfig.scrollHeight],\n  );\n\n  const listStyle = useMemo(\n    () =>\n      ({\n        transform: `translate(0, ${virtualConfig.translateY}px)`,\n        msTransform: `translate(0, ${virtualConfig.translateY}px)`,\n        MozTransform: `translate(0, ${virtualConfig.translateY}px)`,\n        WebkitTransform: `translate(0, ${virtualConfig.translateY}px)`,\n      } as Styles),\n    [virtualConfig.translateY],\n  );\n\n  const handleScrollTo = (params: ComponentScrollToElementParams) => {\n    const { index, key } = params;\n    const targetIndex = index === 0 ? index : index ?? Number(key);\n    if (!targetIndex && targetIndex !== 0) {\n      log.error('List', 'scrollTo: `index` or `key` must exist.');\n      return;\n    }\n    if (targetIndex < 0 || targetIndex >= listItems.length) {\n      log.error('List', `${targetIndex} does not exist in data, check \\`index\\` or \\`key\\` please.`);\n      return;\n    }\n    virtualConfig.scrollToElement({ ...params, index: targetIndex - 1 });\n  };\n\n  return {\n    virtualConfig,\n    cursorStyle,\n    listStyle,\n    isVirtualScroll,\n    onInnerVirtualScroll,\n    scrollToElement: handleScrollTo,\n  };\n};\n"],"names":["useListVirtualScroll","scroll","listRef","listItems","virtualScrollParams","useMemo","data","virtualConfig","useVirtualScroll","isVirtualScroll","lastScrollY","onInnerVirtualScroll","e","target","srcElement","top","scrollTop","handleScroll","cursorStyle","position","width","height","transition","transform","concat","scrollHeight","msTransform","MozTransform","WebkitTransform","listStyle","translateY","handleScrollTo","params","index","key","targetIndex","Number","log","error","length","scrollToElement"],"mappings":"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"}