{"version":3,"file":"useRangeValue.js","sources":["../../../../components/date-picker/hooks/useRangeValue.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport {\n  isValidDate,\n  formatDate,\n  formatTime,\n  getDefaultFormat,\n  initYearMonthTime,\n  extractTimeFormat,\n} from '@tdesign/common-js/date-picker/format';\nimport log from '@tdesign/common-js/log/index';\nimport useControlled from '../../hooks/useControlled';\nimport { TdDateRangePickerProps } from '../type';\n\nexport const PARTIAL_MAP = { first: 'start', second: 'end' };\n\nexport default function useRange(props: TdDateRangePickerProps) {\n  const [value, onChange] = useControlled(props, 'value', props.onChange);\n\n  const { format, timeFormat } = getDefaultFormat({\n    mode: props.mode,\n    format: props.format,\n    enableTimePicker: props.enableTimePicker,\n  });\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(format))\n      log.error('DatePicker', `format: ${format} is invalid，time selection must include time formatting HH:mm:ss`);\n  }\n\n  // warning invalid value\n  if (!Array.isArray(value)) {\n    log.error('DatePicker', `typeof value: ${value} must be Array!`);\n  } else if (!isValidDate(value, format)) {\n    log.error(\n      'DatePicker',\n      `value: ${value} is invalid dateTime! Check whether the value is consistent with format: ${format}`,\n    );\n  }\n\n  const [isFirstValueSelected, setIsFirstValueSelected] = useState(false); // 记录面板点击次数，两次后才自动关闭\n  const [time, setTime] = useState(\n    () => initYearMonthTime({ value, mode: props.mode, format, enableTimePicker: props.enableTimePicker }).time,\n  );\n  const [month, setMonth] = useState<Array<number>>(\n    () => initYearMonthTime({ value, mode: props.mode, format, enableTimePicker: props.enableTimePicker }).month,\n  );\n  const [year, setYear] = useState<Array<number>>(() => initYearMonthTime({ value, mode: props.mode, format }).year);\n  const [cacheValue, setCacheValue] = useState(() => formatDate(value, { format })); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  useEffect(() => {\n    if (!value) {\n      setCacheValue([]);\n      return;\n    }\n    if (!isValidDate(value, format)) return;\n\n    setCacheValue(formatDate(value, { format }));\n    setTime(formatTime(value, format, timeFormat, props.defaultTime));\n    // eslint-disable-next-line\n  }, [value]);\n\n  return {\n    value,\n    onChange,\n    year,\n    setYear,\n    month,\n    setMonth,\n    time,\n    setTime,\n    isFirstValueSelected,\n    setIsFirstValueSelected,\n    cacheValue,\n    setCacheValue,\n  };\n}\n"],"names":["PARTIAL_MAP","first","second","useRange","props","_useControlled","useControlled","onChange","_useControlled2","_slicedToArray","value","_getDefaultFormat","getDefaultFormat","mode","format","enableTimePicker","timeFormat","extractTimeFormat","log","error","concat","Array","isArray","isValidDate","_useState","useState","_useState2","isFirstValueSelected","setIsFirstValueSelected","_useState3","initYearMonthTime","time","_useState4","setTime","_useState5","month","_useState6","setMonth","_useState7","year","_useState8","setYear","_useState9","formatDate","_useState0","cacheValue","setCacheValue","useEffect","formatTime","defaultTime"],"mappings":"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"}