{"version":3,"file":"usePopper.js","sources":["../../../components/hooks/usePopper.ts"],"sourcesContent":["// https://github.com/floating-ui/react-popper/blob/master/src/usePopper.js\n// React popper was archived by the owner on Dec 6, 2024.\n// to maintain this hook in the repo since upgrading to support React 19.0\nimport { useMemo, useRef, useState } from 'react';\nimport { flushSync } from 'react-dom';\nimport {\n  createPopper as defaultCreatePopper,\n  type Options as PopperOptions,\n  type VirtualElement,\n  type State as PopperState,\n  type Instance as PopperInstance,\n} from '@popperjs/core';\n\nimport isEqual from 'react-fast-compare';\nimport useIsomorphicLayoutEffect from './useLayoutEffect';\nimport type { Styles } from '../common';\n\ntype Options = Partial<\n  PopperOptions & {\n    createPopper: typeof defaultCreatePopper;\n  }\n>;\n\ntype Attributes = {\n  [key: string]: { [key: string]: string };\n};\n\ntype State = {\n  styles: Record<string, Styles>;\n  attributes: Attributes;\n};\n\nconst EMPTY_MODIFIERS = [];\n\ntype UsePopperResult = {\n  state?: PopperState;\n  styles: Styles;\n  attributes: Attributes;\n  update: PopperInstance['update'];\n  forceUpdate: PopperInstance['forceUpdate'];\n};\n\nconst fromEntries = (entries: Array<[string, any]>): { [key: string]: any } =>\n  entries.reduce((acc, [key, value]) => {\n    acc[key] = value;\n    return acc;\n  }, {});\n\nconst usePopper = (\n  referenceElement?: Element | VirtualElement,\n  popperElement?: HTMLElement,\n  options: Options = {},\n): UsePopperResult => {\n  const prevOptions = useRef<PopperOptions>(null);\n\n  const optionsWithDefaults = {\n    onFirstUpdate: options.onFirstUpdate,\n    placement: options.placement || 'bottom',\n    strategy: options.strategy || 'absolute',\n    modifiers: options.modifiers || EMPTY_MODIFIERS,\n  };\n\n  const [state, setState] = useState<State>({\n    styles: {\n      popper: {\n        position: optionsWithDefaults.strategy,\n        left: '0',\n        top: '0',\n      },\n      arrow: {\n        position: 'absolute',\n      },\n    },\n    attributes: {},\n  });\n\n  const updateStateModifier = useMemo(\n    () => ({\n      name: 'updateState',\n      enabled: true,\n      phase: 'write',\n      fn: ({ state }) => {\n        const elements = Object.keys(state.elements);\n\n        flushSync(() => {\n          setState({\n            styles: fromEntries(elements.map((element) => [element, state.styles[element] || {}])),\n            attributes: fromEntries(elements.map((element) => [element, state.attributes[element]])),\n          });\n        });\n      },\n      requires: ['computeStyles'],\n    }),\n    [],\n  );\n\n  const popperOptions = useMemo(() => {\n    const newOptions = {\n      onFirstUpdate: optionsWithDefaults.onFirstUpdate,\n      placement: optionsWithDefaults.placement,\n      strategy: optionsWithDefaults.strategy,\n      modifiers: [...optionsWithDefaults.modifiers, updateStateModifier, { name: 'applyStyles', enabled: false }],\n    };\n\n    if (isEqual(prevOptions.current, newOptions)) {\n      return prevOptions.current || newOptions;\n    }\n    prevOptions.current = newOptions;\n    return newOptions;\n  }, [\n    optionsWithDefaults.onFirstUpdate,\n    optionsWithDefaults.placement,\n    optionsWithDefaults.strategy,\n    optionsWithDefaults.modifiers,\n    updateStateModifier,\n  ]);\n\n  const popperInstanceRef = useRef(null);\n\n  useIsomorphicLayoutEffect(() => {\n    if (popperInstanceRef.current) {\n      popperInstanceRef.current.setOptions(popperOptions);\n    }\n  }, [popperOptions]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (referenceElement == null || popperElement == null) {\n      return;\n    }\n\n    const createPopper = options.createPopper || defaultCreatePopper;\n    const popperInstance = createPopper(referenceElement, popperElement, popperOptions);\n\n    popperInstanceRef.current = popperInstance;\n\n    return () => {\n      popperInstance.destroy();\n      popperInstanceRef.current = null;\n    };\n  }, [referenceElement, popperElement, options.createPopper]);\n\n  return {\n    state: popperInstanceRef.current ? popperInstanceRef.current.state : null,\n    styles: state.styles,\n    attributes: state.attributes,\n    update: popperInstanceRef.current ? popperInstanceRef.current.update : null,\n    forceUpdate: popperInstanceRef.current ? popperInstanceRef.current.forceUpdate : null,\n  };\n};\n\nexport default usePopper;\n"],"names":["EMPTY_MODIFIERS","fromEntries","entries","reduce","acc","_ref","_ref2","_slicedToArray","key","value","usePopper","referenceElement","popperElement","options","arguments","length","undefined","prevOptions","useRef","optionsWithDefaults","onFirstUpdate","placement","strategy","modifiers","_useState","useState","styles","popper","position","left","top","arrow","attributes","_useState2","state","setState","updateStateModifier","useMemo","name","enabled","phase","fn","_ref3","elements","Object","keys","flushSync","map","element","requires","popperOptions","newOptions","concat","_toConsumableArray","isEqual","current","popperInstanceRef","useIsomorphicLayoutEffect","setOptions","createPopper","defaultCreatePopper","popperInstance","destroy","update","forceUpdate"],"mappings":"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"}