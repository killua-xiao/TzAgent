{"version":3,"file":"Dropdown.js","sources":["../../../components/dropdown/Dropdown.tsx"],"sourcesContent":["import React, { isValidElement, useState } from 'react';\nimport classNames from 'classnames';\nimport { omit } from 'lodash-es';\nimport { DropdownOption, TdDropdownProps } from './type';\nimport { StyledProps } from '../common';\nimport Popup, { PopupVisibleChangeContext } from '../popup';\nimport DropdownMenu from './DropdownMenu';\nimport DropdownItem from './DropdownItem';\nimport { dropdownDefaultProps } from './defaultProps';\nimport useConfig from '../hooks/useConfig';\nimport useDropdownOptions from './hooks/useDropdownOptions';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport interface DropdownProps extends TdDropdownProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nconst Dropdown: React.FC<DropdownProps> & {\n  DropdownItem: typeof DropdownItem;\n  DropdownMenu: typeof DropdownMenu;\n} = (originalProps) => {\n  const props = useDefaultProps<DropdownProps>(originalProps, dropdownDefaultProps);\n  const {\n    popupProps = {},\n    disabled,\n    placement,\n    trigger,\n    className,\n    children,\n    hideAfterItemClick,\n    options: propsOptions,\n    style,\n  } = props;\n\n  const arrayChildren = React.Children.toArray(children);\n  const { classPrefix } = useConfig();\n  const [isPopupVisible, togglePopupVisible] = useState(false);\n  const dropdownClass = `${classPrefix}-dropdown`;\n\n  const options = useDropdownOptions(arrayChildren, propsOptions);\n\n  const handleMenuClick = (data: DropdownOption, context: { e: React.MouseEvent<HTMLDivElement, MouseEvent> }) => {\n    if (hideAfterItemClick) {\n      togglePopupVisible(false);\n      popupProps?.onVisibleChange?.(false, context);\n    }\n    props.onClick?.(data, context);\n  };\n\n  const handleVisibleChange = (visible: boolean, context: PopupVisibleChangeContext) => {\n    if (disabled || !options.length) return;\n    togglePopupVisible(visible);\n    popupProps?.onVisibleChange?.(visible, context);\n  };\n\n  const renderContent = <DropdownMenu {...props} options={options} onClick={handleMenuClick} />;\n\n  const popupParams = {\n    disabled,\n    placement,\n    trigger,\n    showArrow: false,\n    content: renderContent,\n    ...omit(popupProps, 'onVisibleChange'),\n    overlayInnerClassName: classNames(dropdownClass, className, popupProps?.overlayInnerClassName),\n    overlayInnerStyle: style,\n  };\n\n  const child = arrayChildren?.[0];\n  const dropDownTrigger = isValidElement(child)\n    ? React.cloneElement(child as React.ReactElement<{ disabled: boolean }>, { disabled })\n    : child;\n\n  return (\n    <Popup\n      expandAnimation={true}\n      destroyOnClose={true}\n      visible={isPopupVisible}\n      onVisibleChange={handleVisibleChange}\n      {...popupParams}\n    >\n      {dropDownTrigger}\n    </Popup>\n  );\n};\n\nDropdown.DropdownItem = DropdownItem;\nDropdown.DropdownMenu = DropdownMenu;\n\nDropdown.displayName = 'Dropdown';\n\nexport default Dropdown;\n"],"names":["Dropdown","originalProps","props","useDefaultProps","dropdownDefaultProps","_props$popupProps","popupProps","disabled","placement","trigger","className","children","hideAfterItemClick","propsOptions","options","style","arrayChildren","React","Children","toArray","_useConfig","useConfig","classPrefix","_useState","useState","_useState2","_slicedToArray","isPopupVisible","togglePopupVisible","dropdownClass","useDropdownOptions","handleMenuClick","data","context","_props$onClick","_popupProps$onVisible","onVisibleChange","call","onClick","handleVisibleChange","visible","_popupProps$onVisible2","length","renderContent","createElement","DropdownMenu","_objectSpread","popupParams","showArrow","content","omit","overlayInnerClassName","classNames","overlayInnerStyle","child","dropDownTrigger","isValidElement","cloneElement","Popup","expandAnimation","destroyOnClose","DropdownItem","displayName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,IAAMA,QAAA,GAGF,SAHEA,QAAAA,CAGDC,aAAkB,EAAA;AACf,EAAA,IAAAC,KAAA,GAAQC,eAA+B,CAAAF,aAAA,EAAeG,oBAAoB,CAAA,CAAA;AAC1E,EAAA,IAAAC,iBAAA,GAUFH,KAAA,CATFI;AAAAA,IAAAA,4CAAa,EAAC,GAAAD,iBAAA;IACdE,QAAA,GAQEL,KAAA,CARFK,QAAA;IACAC,SAAA,GAOEN,KAAA,CAPFM,SAAA;IACAC,OAAA,GAMEP,KAAA,CANFO,OAAA;IACAC,SAAA,GAKER,KAAA,CALFQ,SAAA;IACAC,QAAA,GAIET,KAAA,CAJFS,QAAA;IACAC,kBAAA,GAGEV,KAAA,CAHFU,kBAAA;IACSC,YAAA,GAEPX,KAAA,CAFFY,OAAS;IACTC,KAAA,GACEb,KAAA,CADFa,KAAA,CAAA;EAGF,IAAMC,aAAgB,GAAAC,KAAA,CAAMC,QAAS,CAAAC,OAAA,CAAQR,QAAQ,CAAA,CAAA;AAC/C,EAAA,IAAAS,UAAA,GAAkBC,SAAU,EAAA;IAA1BC,WAAY,GAAAF,UAAA,CAAZE,WAAY,CAAA;AACpB,EAAA,IAAAC,SAAA,GAA6CC,SAAS,KAAK,CAAA;IAAAC,UAAA,GAAAC,cAAA,CAAAH,SAAA,EAAA,CAAA,CAAA;AAApDI,IAAAA,cAAA,GAAAF,UAAA,CAAA,CAAA,CAAA;AAAgBG,IAAAA,kBAAkB,GAAAH,UAAA,CAAA,CAAA,CAAA,CAAA;AACzC,EAAA,IAAMI,0BAAmBP,WAAA,EAAA,WAAA,CAAA,CAAA;AAEnB,EAAA,IAAAR,OAAA,GAAUgB,kBAAmB,CAAAd,aAAA,EAAeH,YAAY,CAAA,CAAA;EAExD,IAAAkB,eAAA,GAAkB,SAAlBA,eAAAA,CAAmBC,IAAA,EAAsBC,OAAiE,EAAA;AAAA,IAAA,IAAAC,cAAA,CAAA;AAC9G,IAAA,IAAItB,kBAAoB,EAAA;AAAA,MAAA,IAAAuB,qBAAA,CAAA;MACtBP,kBAAA,CAAmB,KAAK,CAAA,CAAA;MACZtB,UAAA,KAAA,IAAA,IAAAA,UAAA,KAAA6B,KAAAA,CAAAA,IAAAA,CAAAA,qBAAA,GAAA7B,UAAA,CAAA8B,eAAA,MAAAD,IAAAA,IAAAA,qBAAA,eAAAA,qBAAA,CAAAE,IAAA,CAAA/B,UAAA,EAAkB,OAAO2B,OAAO,CAAA,CAAA;AAC9C,KAAA;AACM,IAAA,CAAAC,cAAA,GAAAhC,KAAA,CAAAoC,OAAA,cAAAJ,cAAA,KAAA,KAAA,CAAA,IAAAA,cAAA,CAAAG,IAAA,CAAAnC,KAAA,EAAU8B,MAAMC,OAAO,CAAA,CAAA;GAC/B,CAAA;EAEM,IAAAM,mBAAA,GAAsB,SAAtBA,mBAAAA,CAAuBC,OAAA,EAAkBP,OAAuC,EAAA;AAAA,IAAA,IAAAQ,sBAAA,CAAA;AAChF,IAAA,IAAAlC,QAAA,IAAY,CAACO,OAAQ,CAAA4B,MAAA,EAAQ,OAAA;IACjCd,kBAAA,CAAmBY,OAAO,CAAA,CAAA;IACdlC,UAAA,KAAA,IAAA,IAAAA,UAAA,KAAAmC,KAAAA,CAAAA,IAAAA,CAAAA,sBAAA,GAAAnC,UAAA,CAAA8B,eAAA,MAAAK,IAAAA,IAAAA,sBAAA,eAAAA,sBAAA,CAAAJ,IAAA,CAAA/B,UAAA,EAAkBkC,SAASP,OAAO,CAAA,CAAA;GAChD,CAAA;AAEA,EAAA,IAAMU,+BAAiB1B,KAAA,CAAA2B,aAAA,CAAAC,YAAA,EAAAC,aAAA,CAAAA,aAAA,KAAiB5C,KAAA,CAAA,EAAA,EAAA,EAAA;AAAOY,IAAAA,OAAA,EAAAA,OAAA;AAAkBwB,IAAAA,OAAS,EAAAP,eAAAA;AAAA,GAAA,CAAiB,CAAA,CAAA;AAE3F,EAAA,IAAMgB,WAAc,GAAAD,aAAA,CAAAA,aAAA,CAAA;AAClBvC,IAAAA,QAAA,EAAAA,QAAA;AACAC,IAAAA,SAAA,EAAAA,SAAA;AACAC,IAAAA,OAAA,EAAAA,OAAA;AACAuC,IAAAA,SAAW,EAAA,KAAA;AACXC,IAAAA,OAAS,EAAAN,aAAAA;AAAA,GAAA,EACNO,IAAK,CAAA5C,UAAA,EAAY,iBAAiB,CAAA,CAAA,EAAA,EAAA,EAAA;AACrC6C,IAAAA,qBAAuB,EAAAC,UAAA,CAAWvB,aAAe,EAAAnB,SAAA,EAAWJ,uBAAAA,iCAAAA,WAAY6C,qBAAqB,CAAA;AAC7FE,IAAAA,iBAAmB,EAAAtC,KAAAA;GACrB,CAAA,CAAA;EAEA,IAAMuC,QAAQtC,aAAgB,KAAA,IAAA,IAAhBA,aAAgB,KAAhBA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,aAAgB,CAAA,CAAA,CAAA,CAAA;AACxB,EAAA,IAAAuC,eAAA,gBAAkBC,cAAe,CAAAF,KAAK,CACxC,gBAAArC,KAAA,CAAMwC,aAAaH,KAAoD,EAAA;AAAE/C,IAAAA,QAAS,EAATA,QAAAA;GAAU,CACnF,GAAA+C,KAAA,CAAA;AAEJ,EAAA,sBACGrC,KAAA,CAAA2B,aAAA,CAAAc,KAAA,EAAAZ,aAAA,CAAA;AACCa,IAAAA,eAAiB,EAAA,IAAA;AACjBC,IAAAA,cAAgB,EAAA,IAAA;AAChBpB,IAAAA,OAAS,EAAAb,cAAA;AACTS,IAAAA,eAAiB,EAAAG,mBAAAA;GACbQ,EAAAA,WAAA,CAEHQ,EAAAA,eACH,CAAA,CAAA;AAEJ,EAAA;AAEAvD,QAAA,CAAS6D,YAAe,GAAAA,YAAA,CAAA;AACxB7D,QAAA,CAAS6C,YAAe,GAAAA,YAAA,CAAA;AAExB7C,QAAA,CAAS8D,WAAc,GAAA,UAAA;;;;"}