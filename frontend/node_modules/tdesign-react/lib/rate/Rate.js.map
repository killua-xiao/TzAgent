{"version":3,"file":"Rate.js","sources":["../../../components/rate/Rate.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport classNames from 'classnames';\nimport { StarFilledIcon as TdStarFilledIcon } from 'tdesign-icons-react';\nimport { TooltipLite } from '../tooltip';\nimport { TdRateProps } from './type';\nimport { StyledProps } from '../common';\n\nimport { useLocaleReceiver } from '../locale/LocalReceiver';\nimport useConfig from '../hooks/useConfig';\nimport useGlobalIcon from '../hooks/useGlobalIcon';\nimport useControlled from '../hooks/useControlled';\nimport { rateDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport interface RateProps extends TdRateProps, StyledProps {}\n\ninterface RateIconProps {\n  icon: React.ReactNode;\n  color: string;\n  size: string;\n}\n\n// 评分图标\n// fix: 2550\nconst RateIcon: React.FC<RateIconProps> = ({ icon, ...props }) => {\n  const { StarFilledIcon } = useGlobalIcon({ StarFilledIcon: TdStarFilledIcon });\n  if (React.isValidElement(icon)) {\n    return React.cloneElement(icon, props);\n  }\n  return <StarFilledIcon {...props} />;\n};\n\nconst Rate = React.forwardRef<HTMLDivElement, RateProps>((originalProps, ref) => {\n  const props = useDefaultProps<RateProps>(originalProps, rateDefaultProps);\n\n  const { allowHalf, color, count, disabled, gap, showText, size, icon, className, style, onChange, texts, clearable } =\n    props;\n  const [locale, t] = useLocaleReceiver('rate');\n\n  const displayTexts = texts.length ? texts : t(locale.rateText);\n\n  const { classPrefix } = useConfig();\n  const [starValue, setStarValue] = useControlled(props, 'value', onChange);\n\n  const [hoverValue, setHoverValue] = useState<number | undefined>(undefined);\n  const displayValue = hoverValue || starValue;\n\n  const rootRef = React.useRef<HTMLUListElement>(null);\n\n  const activeColor = Array.isArray(color) ? color[0] : color;\n  const defaultColor = Array.isArray(color) ? color[1] : 'var(--td-bg-color-component)';\n\n  const getStarValue = (event: React.MouseEvent<HTMLLIElement, globalThis.MouseEvent>, index: number) => {\n    if (allowHalf) {\n      const rootNode = rootRef.current;\n      const { left } = rootNode.getBoundingClientRect();\n      const firstStar = rootNode.firstChild as HTMLElement;\n      const { width } = firstStar.getBoundingClientRect();\n      const { clientX } = event;\n      const starMiddle = width * (index - 0.5) + gap * (index - 1);\n      if (clientX - left >= starMiddle) {\n        return index;\n      }\n      if (clientX - left < starMiddle) {\n        return index - 0.5;\n      }\n    }\n\n    return index;\n  };\n\n  const mouseEnterHandler = (event: React.MouseEvent<HTMLLIElement, globalThis.MouseEvent>, index: number) => {\n    if (disabled) {\n      return;\n    }\n    setHoverValue(getStarValue(event, index));\n  };\n\n  const mouseLeaveHandler = () => {\n    if (disabled) {\n      return;\n    }\n    setHoverValue(undefined);\n  };\n\n  const clickHandler = (event: React.MouseEvent<HTMLLIElement, globalThis.MouseEvent>, index: number) => {\n    if (disabled) {\n      return;\n    }\n\n    let value = getStarValue(event, index);\n    if (clearable && value === starValue) {\n      value = 0;\n      setHoverValue(undefined);\n    }\n\n    setStarValue(value);\n  };\n\n  const getStarCls = (index: number) => {\n    if (allowHalf && index + 0.5 === displayValue) {\n      return `${classPrefix}-rate__item--half`;\n    }\n    if (index >= displayValue) {\n      return '';\n    }\n    if (index < displayValue) {\n      return `${classPrefix}-rate__item--full`;\n    }\n  };\n\n  return (\n    <div\n      ref={ref}\n      style={style}\n      className={classNames(`${classPrefix}-rate`, className)}\n      onMouseLeave={mouseLeaveHandler}\n    >\n      <ul className={`${classPrefix}-rate__list`} style={{ gap }} ref={rootRef}>\n        {[...Array(count)].map((_, index) => (\n          <li\n            key={index}\n            className={classNames(`${classPrefix}-rate__item`, getStarCls(index))}\n            onClick={(event) => clickHandler(event, index + 1)}\n            onMouseMove={(event) => mouseEnterHandler(event, index + 1)}\n          >\n            {showText ? (\n              <TooltipLite key={index} content={displayTexts[displayValue - 1]}>\n                <div className={`${classPrefix}-rate__star-top`}>\n                  <RateIcon size={size} color={activeColor} icon={icon} />\n                </div>\n                <div className={`${classPrefix}-rate__star-bottom`}>\n                  <RateIcon size={size} color={defaultColor} icon={icon} />\n                </div>\n              </TooltipLite>\n            ) : (\n              <>\n                <div className={`${classPrefix}-rate__star-top`}>\n                  <RateIcon size={size} color={activeColor} icon={icon} />\n                </div>\n                <div className={`${classPrefix}-rate__star-bottom`}>\n                  <RateIcon size={size} color={defaultColor} icon={icon} />\n                </div>\n              </>\n            )}\n          </li>\n        ))}\n      </ul>\n      {showText && <div className={`${classPrefix}-rate__text`}>{displayTexts[displayValue - 1]}</div>}\n    </div>\n  );\n});\n\nRate.displayName = 'Rate';\n\nexport default Rate;\n"],"names":["RateIcon","_ref","icon","props","_useGlobalIcon","useGlobalIcon","StarFilledIcon","TdStarFilledIcon","React","isValidElement","cloneElement","createElement","_objectSpread","Rate","forwardRef","originalProps","ref","useDefaultProps","rateDefaultProps","allowHalf","color","count","disabled","gap","showText","size","className","style","onChange","texts","clearable","_useLocaleReceiver","useLocaleReceiver","_useLocaleReceiver2","_slicedToArray","locale","t","displayTexts","length","rateText","_useConfig","useConfig","classPrefix","_useControlled","useControlled","_useControlled2","starValue","setStarValue","_useState","useState","_useState2","hoverValue","setHoverValue","displayValue","rootRef","useRef","activeColor","Array","isArray","defaultColor","getStarValue","event","index","rootNode","current","_rootNode$getBounding","getBoundingClientRect","left","firstStar","firstChild","_firstStar$getBoundin","width","clientX","starMiddle","mouseEnterHandler","mouseLeaveHandler","clickHandler","value","getStarCls","concat","classNames","onMouseLeave","_toConsumableArray","map","_","key","onClick","onMouseMove","TooltipLite","content","Fragment","displayName"],"mappings":"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"}