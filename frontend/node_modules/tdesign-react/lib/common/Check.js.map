{"version":3,"file":"Check.js","sources":["../../../components/common/Check.tsx"],"sourcesContent":["import React, { forwardRef, useContext, MouseEvent, ChangeEvent } from 'react';\nimport classNames from 'classnames';\nimport { isBoolean } from 'lodash-es';\nimport { omit } from '../_util/helper';\nimport { StyledProps } from '../common';\nimport useConfig from '../hooks/useConfig';\nimport useControlled from '../hooks/useControlled';\nimport { TdCheckboxProps } from '../checkbox/type';\n\nexport interface CheckProps extends TdCheckboxProps, StyledProps {\n  type: 'radio' | 'radio-button' | 'checkbox';\n  allowUncheck?: boolean;\n  title?: string;\n  children?: React.ReactNode;\n  stopLabelTrigger?: Boolean;\n}\n\n/**\n * Check 组件支持使用 CheckContext 进行状态托管\n */\nexport const CheckContext = React.createContext<CheckContextValue>(null);\n\n/**\n * 托管 Check 组件的状态，请提供 inject() 方法注入托管好的 props\n */\nexport interface CheckContextValue {\n  inject: (props: CheckProps) => CheckProps;\n}\n\nconst Check = forwardRef<HTMLLabelElement, CheckProps>((_props, ref) => {\n  // 支持从 Context 注入\n  const context = useContext(CheckContext);\n  const props = context ? context.inject(_props) : _props;\n\n  const {\n    allowUncheck = false,\n    type,\n    disabled,\n    name,\n    value,\n    onChange,\n    indeterminate,\n    children,\n    label,\n    className,\n    style,\n    readonly,\n    onClick,\n    ...htmlProps\n  } = props;\n\n  const { classPrefix } = useConfig();\n\n  const TOnChange: (\n    checked: boolean,\n    context: { e: ChangeEvent<HTMLInputElement> | MouseEvent<HTMLInputElement> },\n  ) => void = onChange;\n\n  const [internalChecked, setInternalChecked] = useControlled(props, 'checked', TOnChange);\n\n  const labelClassName = classNames(`${classPrefix}-${type}`, className, {\n    [`${classPrefix}-is-checked`]: internalChecked,\n    [`${classPrefix}-is-disabled`]: disabled,\n    [`${classPrefix}-is-indeterminate`]: indeterminate,\n  });\n\n  const isDisabled = disabled || readonly;\n\n  const input = (\n    <input\n      readOnly={readonly}\n      type={type === 'radio-button' ? 'radio' : type}\n      className={`${classPrefix}-${type}__former`}\n      checked={internalChecked}\n      disabled={disabled}\n      name={name}\n      tabIndex={-1}\n      value={isBoolean(value) ? Number(value) : value}\n      data-value={typeof value === 'string' ? `'${value}'` : value}\n      data-allow-uncheck={allowUncheck || undefined}\n      onClick={(e) => {\n        e.stopPropagation();\n        if ((type === 'radio-button' || type === 'radio') && allowUncheck && internalChecked) {\n          setInternalChecked(!e.currentTarget.checked, { e });\n        }\n      }}\n      onChange={(e) => {\n        if (isDisabled) return;\n        setInternalChecked(e.currentTarget.checked, { e });\n      }}\n    />\n  );\n  // Checkbox/ Radio 内容为空则不再渲染 span，不存在 0:Number 的情况\n  const showLabel = !!(children || label);\n\n  const handleLabelClick = (event: MouseEvent<HTMLSpanElement>) => {\n    // 在tree等组件中使用  阻止label触发checked 与expand冲突\n    if (props.stopLabelTrigger) {\n      event.preventDefault();\n    }\n  };\n\n  const onInnerClick = (e: MouseEvent<HTMLLabelElement>) => {\n    if (isDisabled) return;\n    onClick?.({ e });\n  };\n\n  return (\n    <label\n      ref={ref}\n      tabIndex={disabled ? undefined : 0}\n      className={labelClassName}\n      title={props.title}\n      style={style}\n      {...omit(htmlProps, ['checkAll', 'stopLabelTrigger'])}\n      onClick={onInnerClick}\n    >\n      {input}\n      <span className={`${classPrefix}-${type}__input`} />\n      {showLabel && (\n        <span key=\"label\" className={`${classPrefix}-${type}__label`} onClick={handleLabelClick}>\n          {children || label}\n        </span>\n      )}\n    </label>\n  );\n});\n\nCheck.displayName = 'Check';\n\nexport default Check;\n"],"names":["CheckContext","React","createContext","Check","forwardRef","_props","ref","context","useContext","props","inject","_props$allowUncheck","allowUncheck","type","disabled","name","value","onChange","indeterminate","children","label","className","style","readonly","onClick","htmlProps","_objectWithoutProperties","_excluded","_useConfig","useConfig","classPrefix","TOnChange","_useControlled","useControlled","_useControlled2","_slicedToArray","internalChecked","setInternalChecked","labelClassName","classNames","concat","_defineProperty","isDisabled","input","createElement","readOnly","checked","tabIndex","isBoolean","Number","e","stopPropagation","currentTarget","showLabel","handleLabelClick","event","stopLabelTrigger","preventDefault","onInnerClick","_objectSpread","title","omit","key","displayName"],"mappings":"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"}