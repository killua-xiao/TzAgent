{"version":3,"file":"useControlled.js","sources":["../../../components/hooks/useControlled.ts"],"sourcesContent":["import { useState } from 'react';\nimport { upperFirst } from 'lodash-es';\nimport noop from '../_util/noop';\n\nexport interface ChangeHandler<T, P extends any[]> {\n  (value: T, ...args: P);\n}\n\ntype DefaultOptions<T extends string> = `default${Capitalize<T>}`;\n\ntype ToString<T extends string | number | symbol> = T extends string ? T : `${Extract<T, number>}`;\n\nconst useControlled: <P extends any[], R extends object, K extends keyof R>(\n  props: R,\n  valueKey: K,\n  onChange: ChangeHandler<R[K], P>,\n  defaultOptions?:\n    | {\n        [key in DefaultOptions<ToString<K>>]: R[K];\n      }\n    | object,\n) => [R[K], ChangeHandler<R[K], P>] = (props = {} as any, valueKey, onChange, defaultOptions = {}) => {\n  // 外部设置 props，说明希望受控\n  const controlled = Reflect.has(props, valueKey);\n  // 受控属性\n  const value = props[valueKey];\n  // 约定受控属性的非受控 key 为 defaultXxx，某些条件下要在运行时确定 defaultXxx 则通过 defaultOptions 来覆盖\n  const defaultValue =\n    defaultOptions[`default${upperFirst(valueKey as string)}`] || props[`default${upperFirst(valueKey as string)}`];\n\n  // 无论是否受控，都要维护一个内部变量，默认值由 defaultValue 控制\n  const [internalValue, setInternalValue] = useState(defaultValue);\n\n  // 受控模式\n  if (controlled) return [value, onChange || noop];\n\n  // 非受控模式\n  return [\n    internalValue,\n    (newValue, ...args) => {\n      setInternalValue(newValue);\n      onChange?.(newValue, ...args);\n    },\n  ];\n};\n\nexport default useControlled;\n"],"names":["useControlled","props","arguments","length","undefined","valueKey","onChange","defaultOptions","controlled","Reflect","has","value","defaultValue","upperFirst","concat","_useState","useState","_useState2","_slicedToArray","internalValue","setInternalValue","noop","newValue","_len","args","Array","_key","apply"],"mappings":";;;;;;;;;;;;AAYA,IAAMA,aAAA,GASgC,SAThCA,aAAAA,GASgG;AAAA,EAAA,IAA/DC,KAAQ,GAAAC,SAAA,CAAAC,MAAA,GAAA,CAAA,IAAAD,SAAA,CAAA,CAAA,CAAA,KAAAE,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAA;MAAWG,QAAU,GAAAH,SAAA,CAAAC,MAAA,GAAAD,CAAAA,GAAAA,SAAA,MAAAE,SAAA,CAAA;EAAA,IAAAE,QAAA,GAAAJ,SAAA,CAAAC,MAAA,GAAAD,CAAAA,GAAAA,SAAA,MAAAE,SAAA,CAAA;AAAA,EAAA,IAAUG,cAAiB,GAAAL,SAAA,CAAAC,MAAA,GAAA,CAAA,IAAAD,SAAA,CAAA,CAAA,CAAA,KAAAE,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAA,EAAO,CAAA;EAEpG,IAAMM,UAAa,GAAAC,OAAA,CAAQC,GAAI,CAAAT,KAAA,EAAOI,QAAQ,CAAA,CAAA;AAE9C,EAAA,IAAMM,QAAQV,KAAM,CAAAI,QAAA,CAAA,CAAA;EAEd,IAAAO,YAAA,GACJL,gCAAyBM,UAAA,CAAWR,QAAkB,CAAQ,EAAA,IAAAJ,KAAA,WAAAa,MAAA,CAAgBD,UAAA,CAAWR,QAAkB,CAAA,CAAA,CAAA,CAAA;AAG7G,EAAA,IAAAU,SAAA,GAA0CC,SAASJ,YAAY,CAAA;IAAAK,UAAA,GAAAC,cAAA,CAAAH,SAAA,EAAA,CAAA,CAAA;AAAxDI,IAAAA,aAAA,GAAAF,UAAA,CAAA,CAAA,CAAA;AAAeG,IAAAA,gBAAgB,GAAAH,UAAA,CAAA,CAAA,CAAA,CAAA;EAGlC,IAAAT,UAAA,EAAmB,OAAA,CAACG,KAAO,EAAAL,QAAA,IAAYe,IAAI,CAAA,CAAA;AAGxC,EAAA,OAAA,CACLF,aAAA,EACA,UAACG,UAAsB;IACrBF,gBAAA,CAAiBE,QAAQ,CAAA,CAAA;IAAA,KAAAC,IAAAA,IAAA,GAAArB,SAAA,CAAAC,MAAA,EADbqB,IAAS,OAAAC,KAAA,CAAAF,IAAA,GAAAA,CAAAA,GAAAA,IAAA,WAAAG,IAAA,GAAA,CAAA,EAAAA,IAAA,GAAAH,IAAA,EAAAG,IAAA,EAAA,EAAA;AAATF,MAAAA,IAAS,CAAAE,IAAA,GAAAxB,CAAAA,CAAAA,GAAAA,SAAA,CAAAwB,IAAA,CAAA,CAAA;AAAA,KAAA;AAEVpB,IAAAA,QAAA,KAAAA,IAAAA,IAAAA,QAAA,KAAAA,KAAAA,CAAAA,IAAAA,QAAA,CAAAqB,KAAA,CAAAL,KAAAA,CAAAA,EAAAA,CAAAA,QAAA,CAAAR,CAAAA,MAAA,CAAaU,IAAI,CAAA,CAAA,CAAA;AAC9B,GAAA,CACF,CAAA;AACF;;;;"}