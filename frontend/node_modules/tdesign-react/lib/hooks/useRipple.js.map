{"version":3,"file":"useRipple.js","sources":["../../../components/hooks/useRipple.ts"],"sourcesContent":["import { useEffect, useCallback, useMemo } from 'react';\nimport setStyle from '@tdesign/common-js/utils/setStyle';\nimport useConfig from './useConfig';\nimport useAnimation from './useAnimation';\nimport { canUseDocument } from '../_util/dom';\n\nconst period = 200;\nconst noneRippleBg = 'rgba(0, 0, 0, 0)';\nconst defaultRippleColor = 'rgba(0, 0, 0, 0.35)';\n\n// 设置动画颜色 get the ripple animation color\nconst getRippleColor = (el: HTMLElement, fixedRippleColor?: string) => {\n  // get fixed color from params\n  if (fixedRippleColor) {\n    return fixedRippleColor;\n  }\n  // get dynamic color from the dataset\n  if (el?.dataset?.ripple) {\n    const rippleColor = el.dataset.ripple;\n    return rippleColor;\n  }\n  // use css variable\n  const cssVariable = getComputedStyle(el).getPropertyValue('--ripple-color');\n  if (cssVariable) {\n    return cssVariable;\n  }\n  return defaultRippleColor;\n};\n\n/**\n * 斜八角动画 hooks 支持三种方式使用\n * 1. fixedRippleColor 固定色值 useRipple(ref,fixedRippleColor);\n * 2. dynamicColor 动态色值 data.ripple=\"rippleColor\" useRipple(ref)\n * 3. CSS variables（recommended） 配合节点对应 CSS 设置 --ripple-color useRipple(ref)\n * @param dom 需要使用斜八角动画的 DOM\n * @param fixedRippleColor 斜八角的动画颜色\n */\nexport default function useRipple(el: HTMLElement, fixedRippleColor?: string): void {\n  const { classPrefix } = useConfig();\n  // 全局配置\n  const { keepRipple } = useAnimation();\n  const rippleContainer = useMemo(() => {\n    if (!canUseDocument) return null;\n    const container = document.createElement('div');\n    container.className = `${classPrefix}-ripple`;\n\n    return container;\n  }, [classPrefix]);\n\n  // 为节点添加斜八角动画 add ripple to the DOM and set up the animation\n  const handleAddRipple = useCallback(\n    (e) => {\n      const rippleColor = getRippleColor(el, fixedRippleColor);\n      if (e.button !== 0 || !el || !keepRipple) return;\n\n      if (\n        el.classList.contains(`${classPrefix}-is-active`) ||\n        el.classList.contains(`${classPrefix}-is-disabled`) ||\n        el.classList.contains(`${classPrefix}-is-checked`) ||\n        el.classList.contains(`${classPrefix}-is-loading`)\n      )\n        return;\n\n      const elStyle = getComputedStyle(el);\n\n      const elBorder = parseInt(elStyle.borderWidth, 10);\n      const border = elBorder > 0 ? elBorder : 0;\n      const width = el.offsetWidth;\n      const height = el.offsetHeight;\n\n      if (rippleContainer.parentNode === null) {\n        setStyle(rippleContainer, {\n          position: 'absolute',\n          left: `${0 - border}px`,\n          top: `${0 - border}px`,\n          width: `${width}px`,\n          height: `${height}px`,\n          borderRadius: elStyle.borderRadius,\n          pointerEvents: 'none',\n          overflow: 'hidden',\n        });\n        el.appendChild(rippleContainer);\n      }\n      // 新增一个 ripple\n      const ripple = document.createElement('div');\n\n      ripple.className = `${classPrefix}-ripple__inner`;\n\n      setStyle(ripple, {\n        marginTop: '0',\n        marginLeft: '0',\n        right: `${width}px`,\n        width: `${width + 20}px`,\n        height: '100%',\n        transition: `transform ${period}ms cubic-bezier(.38, 0, .24, 1), background ${period * 2}ms linear`,\n        transform: 'skewX(-8deg)',\n        pointerEvents: 'none',\n        position: 'absolute',\n        zIndex: 0,\n        backgroundColor: rippleColor,\n        opacity: '0.9',\n      });\n\n      // fix zIndex：避免遮盖内部元素\n      const elMap = new WeakMap();\n      for (let n = el.children.length, i = 0; i < n; ++i) {\n        const child = el.children[i];\n        if ((child as HTMLElement).style.zIndex === '' && child !== rippleContainer) {\n          (child as HTMLElement).style.zIndex = '1';\n          elMap.set(child, true);\n        }\n      }\n\n      // fix position\n      const initPosition = el.style.position ? el.style.position : getComputedStyle(el).position;\n      if (initPosition === '' || initPosition === 'static') {\n        // eslint-disable-next-line no-param-reassign\n        el.style.position = 'relative';\n      }\n      rippleContainer.insertBefore(ripple, rippleContainer.firstChild);\n\n      setTimeout(() => {\n        ripple.style.transform = `translateX(${width}px)`;\n      }, 0);\n      // 清除动画节点 clear ripple container\n      const handleClearRipple = () => {\n        ripple.style.backgroundColor = noneRippleBg;\n\n        if (!el) return;\n\n        el.removeEventListener('pointerup', handleClearRipple, false);\n        el.removeEventListener('pointerleave', handleClearRipple, false);\n\n        setTimeout(() => {\n          ripple.remove();\n          if (rippleContainer.children.length === 0) rippleContainer.remove();\n        }, period * 2 + 100);\n      };\n\n      el.addEventListener('pointerup', handleClearRipple, false);\n      el.addEventListener('pointerleave', handleClearRipple, false);\n    },\n    [classPrefix, el, fixedRippleColor, rippleContainer, keepRipple],\n  );\n\n  useEffect(() => {\n    if (!el) return;\n    el.addEventListener('pointerdown', handleAddRipple, false);\n\n    return () => {\n      el.removeEventListener('pointerdown', handleAddRipple, false);\n    };\n  }, [handleAddRipple, fixedRippleColor, el]);\n}\n"],"names":["period","noneRippleBg","defaultRippleColor","getRippleColor","el","fixedRippleColor","_el$dataset","dataset","ripple","rippleColor","cssVariable","getComputedStyle","getPropertyValue","useRipple","_useConfig","useConfig","classPrefix","_useAnimation","useAnimation","keepRipple","rippleContainer","useMemo","canUseDocument","container","document","createElement","className","handleAddRipple","useCallback","e","button","classList","contains","concat","elStyle","elBorder","parseInt","borderWidth","border","width","offsetWidth","height","offsetHeight","parentNode","setStyle","position","left","top","borderRadius","pointerEvents","overflow","appendChild","marginTop","marginLeft","right","transition","transform","zIndex","backgroundColor","opacity","elMap","WeakMap","n","children","length","i","child","style","set","initPosition","insertBefore","firstChild","setTimeout","handleClearRipple","removeEventListener","remove","addEventListener","useEffect"],"mappings":"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"}