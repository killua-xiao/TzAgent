{"version":3,"file":"useMultiple.js","sources":["../../../components/select-input/useMultiple.tsx"],"sourcesContent":["import React, { useRef, MouseEvent } from 'react';\nimport { isObject } from 'lodash-es';\nimport classNames from 'classnames';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys, SelectInputValue } from './type';\nimport TagInput, { TagInputValue } from '../tag-input';\nimport { SelectInputCommonProperties } from './interface';\nimport useControlled from '../hooks/useControlled';\nimport useConfig from '../hooks/useConfig';\nimport { InputRef } from '../input';\nimport { StyledProps } from '../common';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent<SVGElement> }) => void;\n  popupVisible: boolean;\n  allowInput: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport interface SelectInputProps extends TdSelectInputProps, StyledProps {\n  options?: any[]; // 参数穿透options, 给SelectInput/SelectInput 自定义选中项呈现的内容和多选状态下设置折叠项内容\n}\n\nexport default function useMultiple(props: SelectInputProps) {\n  const { value } = props;\n  const { classPrefix } = useConfig();\n  const tagInputRef = useRef<InputRef>(null);\n  const [tInputValue, setTInputValue] = useControlled(props, 'inputValue', props.onInputChange);\n  const iKeys: SelectInputKeys = { ...DEFAULT_KEYS, ...props.keys };\n\n  const getTags = () => {\n    if (!(value instanceof Array)) {\n      if (['', null, undefined].includes(value as any)) return [];\n      return isObject(value) ? [value[iKeys.label]] : [value];\n    }\n    return value.map((item: SelectInputValue) => (isObject(item) ? item[iKeys.label] : item));\n  };\n  const tags = getTags();\n  const tPlaceholder = !tags || !tags.length ? props.placeholder : '';\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n  };\n\n  const renderSelectMultiple = (p: RenderSelectMultipleParams) => (\n    <TagInput\n      ref={tagInputRef}\n      {...p.commonInputProps}\n      autoWidth={props.autoWidth}\n      readonly={props.readonly}\n      minCollapsedNum={props.minCollapsedNum}\n      collapsedItems={props.collapsedItems}\n      tag={props.tag}\n      valueDisplay={props.valueDisplay}\n      placeholder={tPlaceholder}\n      options={props.options}\n      value={tags}\n      inputValue={p.popupVisible && p.allowInput ? tInputValue : ''}\n      onChange={onTagInputChange}\n      onInputChange={(val, context) => {\n        // 筛选器统一特性：筛选器按下回车时不清空输入框\n        if (context?.trigger === 'enter' || context?.trigger === 'blur') return;\n        setTInputValue(val, { trigger: context.trigger, e: context.e });\n      }}\n      tagProps={props.tagProps}\n      onClear={p.onInnerClear}\n      // [Important Info]: SelectInput.blur is not equal to TagInput, example: click popup panel\n      onFocus={(val, context) => {\n        props.onFocus?.(props.value, { ...context, tagInputValue: val });\n      }}\n      onBlur={!props.panel ? props.onBlur : null}\n      {...props.tagInputProps}\n      inputProps={{\n        ...props.inputProps,\n        readonly: !props.allowInput || props.readonly,\n        inputClass: classNames(props.tagInputProps?.className, {\n          [`${classPrefix}-input--focused`]: p.popupVisible,\n          [`${classPrefix}-is-focused`]: p.popupVisible,\n        }),\n      }}\n    />\n  );\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    multipleInputValue: tInputValue,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","value","_useConfig","useConfig","classPrefix","tagInputRef","useRef","_useControlled","useControlled","onInputChange","_useControlled2","_slicedToArray","tInputValue","setTInputValue","iKeys","keys","getTags","Array","includes","isObject","map","item","tags","tPlaceholder","length","placeholder","onTagInputChange","val","context","_props$onTagChange","trigger","_context$e","e","stopPropagation","onTagChange","call","renderSelectMultiple","p","_props$tagInputProps","React","createElement","TagInput","_objectSpread","ref","commonInputProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","options","inputValue","popupVisible","allowInput","onChange","tagProps","onClear","onInnerClear","onFocus","_props$onFocus","tagInputValue","onBlur","panel","tagInputProps","inputProps","inputClass","classNames","className","_defineProperty","concat","multipleInputValue"],"mappings":"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"}