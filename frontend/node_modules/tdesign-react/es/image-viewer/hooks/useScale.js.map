{"version":3,"file":"useScale.js","sources":["../../../../components/image-viewer/hooks/useScale.ts"],"sourcesContent":["import { useCallback, useEffect, useRef, useState } from 'react';\nimport type { ImageScale } from '../type';\n\nconst useScale = (imageScale: ImageScale, visible: boolean) => {\n  const { max = Infinity, min = 0, step = 0.1, defaultScale = 1 } = imageScale;\n\n  const calcDefaultScale = useCallback(() => Math.max(Math.min(defaultScale, max), min), [defaultScale, max, min]);\n\n  const distance = useRef(0);\n  const [scale, setScale] = useState(calcDefaultScale());\n\n  const onZoom = useCallback(() => {\n    setScale((scale) => {\n      const newScale = scale + step;\n      if (newScale < min) return min;\n      if (newScale > max) return max;\n      return newScale;\n    });\n  }, [max, min, step]);\n\n  const onZoomOut = useCallback(() => {\n    setScale((scale) => {\n      const newScale = scale - step;\n      if (newScale < min) return min;\n      if (newScale > max) return max;\n      return newScale;\n    });\n  }, [max, min, step]);\n\n  const onResetScale = useCallback(() => {\n    setScale(calcDefaultScale());\n  }, [calcDefaultScale]);\n\n  // 鼠标滚轮缩放\n  const onWheel = useCallback((e: WheelEvent) => {\n    e.preventDefault();\n    e.deltaY < 0 ? onZoom() : onZoomOut();\n  }, [onZoom, onZoomOut]);\n\n  // 双指缩放\n  const onTouchStart = useCallback((e: TouchEvent) => {\n    if (e.touches.length !== 2) return;\n    e.preventDefault();\n    const [touch1, touch2] = Array.from(e.touches);\n    distance.current = Math.hypot(touch2.pageX - touch1.pageX, touch2.pageY - touch1.pageY);\n  }, []);\n\n  const onTouchMove = useCallback((e: TouchEvent) => {\n    if (e.touches.length !== 2) return;\n    e.preventDefault();\n    const [touch1, touch2] = Array.from(e.touches);\n    const currentDistance = Math.hypot(touch2.pageX - touch1.pageX, touch2.pageY - touch1.pageY);\n    if (currentDistance > distance.current) {\n      onZoom();\n    } else {\n      onZoomOut();\n    }\n    distance.current = currentDistance;\n  }, [onZoom, onZoomOut]);\n\n  const onTouchEnd = useCallback(() => {\n    distance.current = 0;\n  }, []);\n\n  useEffect(() => {\n    if (!visible) return;\n    document.addEventListener('wheel', onWheel, { passive: false });\n    document.addEventListener('touchstart', onTouchStart, { passive: false });\n    document.addEventListener('touchmove', onTouchMove, { passive: false });\n    document.addEventListener('touchend', onTouchEnd);\n    return () => {\n      document.removeEventListener('wheel', onWheel);\n      document.removeEventListener('touchstart', onTouchStart);\n      document.removeEventListener('touchmove', onTouchMove);\n      document.removeEventListener('touchend', onTouchEnd);\n    };\n  }, [visible, onWheel, onTouchStart, onTouchMove, onTouchEnd]);\n\n  return {\n    scale,\n    onZoom,\n    onZoomOut,\n    onResetScale,\n  };\n};\n\nexport default useScale;\n"],"names":["useScale","imageScale","visible","_imageScale$max","max","Infinity","_imageScale$min","min","step","_imageScale$step","_imageScale$defaultSc","defaultScale","calcDefaultScale","useCallback","Math","distance","useRef","_useState","useState","_useState2","_slicedToArray","scale","setScale","onZoom","newScale","onZoomOut","onResetScale","onWheel","e","preventDefault","deltaY","onTouchStart","touches","length","_Array$from","Array","from","_Array$from2","touch1","touch2","current","hypot","pageX","pageY","onTouchMove","_Array$from3","_Array$from4","currentDistance","onTouchEnd","useEffect","document","addEventListener","passive","removeEventListener"],"mappings":"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"}