{"version":3,"file":"Steps.js","sources":["../../../components/steps/Steps.tsx"],"sourcesContent":["import React, { useCallback, useMemo } from 'react';\nimport classnames from 'classnames';\nimport useConfig from '../hooks/useConfig';\nimport useControlled from '../hooks/useControlled';\nimport forwardRefWithStatics from '../_util/forwardRefWithStatics';\nimport { TdStepsProps, TdStepItemProps } from './type';\nimport { StyledProps } from '../common';\nimport StepItem from './StepItem';\nimport StepsContext from './StepsContext';\nimport { stepsDefaultProps } from './defaultProps';\nimport useDefaultProps from '../hooks/useDefaultProps';\nimport type { StepItemProps } from './StepItem';\n\nexport interface StepsProps extends TdStepsProps, StyledProps {\n  children?: React.ReactNode;\n}\n\nconst Steps = forwardRefWithStatics(\n  (originalProps: StepsProps, ref) => {\n    const props = useDefaultProps<StepsProps>(originalProps, stepsDefaultProps);\n    const { style, readonly, layout, theme, sequence, separator, children, options } = props;\n    const { classPrefix } = useConfig();\n\n    const [current, onChange] = useControlled(props, 'current', props.onChange);\n\n    // 整理 StepItem value 映射\n    const indexMap = useMemo(() => {\n      const map = {};\n      if (options) {\n        options.forEach((item, index) => {\n          if (item.value !== undefined) {\n            map[item.value] = index;\n          }\n        });\n      } else {\n        React.Children.forEach(children, (child, index) => {\n          if (!React.isValidElement(child)) {\n            return;\n          }\n          if ((child as React.ReactElement<any>).props.value !== undefined) {\n            map[(child as React.ReactElement<any>).props.value] = index;\n          }\n        });\n      }\n      return map;\n    }, [options, children]);\n\n    const handleStatus = useCallback(\n      (item: TdStepItemProps, index: number) => {\n        if (current === 'FINISH') {\n          return 'finish';\n        }\n        if (item.status && item.status !== 'default') {\n          return item.status;\n        }\n        // value 不存在时，使用 index 进行区分每一个步骤\n        if (item.value === undefined) {\n          if (sequence === 'positive' && typeof current === 'number' && index < current) {\n            return 'finish';\n          }\n          if (sequence === 'reverse' && typeof current === 'number' && index > current) {\n            return 'finish';\n          }\n        }\n\n        // value 存在，找匹配位置\n        if (item.value !== undefined) {\n          const matchIndex = indexMap[current];\n          if (matchIndex === undefined) {\n            console.warn('TDesign Steps Warn: The current `value` is not exist.');\n            return 'default';\n          }\n          if (sequence === 'positive' && index < matchIndex) {\n            return 'finish';\n          }\n          if (sequence === 'reverse' && index > matchIndex) {\n            return 'finish';\n          }\n        }\n        const key = item.value ?? index;\n        if (key === current) {\n          return 'process';\n        }\n        return 'default';\n      },\n      [current, sequence, indexMap],\n    );\n\n    const stepItemList = useMemo<React.ReactNode[]>(() => {\n      if (options) {\n        const optionsDisplayList = sequence === 'reverse' ? options.reverse() : options;\n        return options.map<React.ReactNode>((item, index) => {\n          const stepIndex = sequence === 'reverse' ? optionsDisplayList.length - index - 1 : index;\n          return <StepItem key={index} {...item} index={stepIndex} status={handleStatus(item, index)} />;\n        });\n      }\n\n      const childrenList = React.Children.toArray(children);\n      const childrenDisplayList = sequence === 'reverse' ? childrenList.reverse() : childrenList;\n\n      return childrenList.map((child: React.ReactElement<StepItemProps>, index: number) => {\n        const stepIndex = sequence === 'reverse' ? childrenDisplayList.length - index - 1 : index;\n        return React.cloneElement(child, {\n          ...child.props,\n          index: stepIndex,\n          status: handleStatus(child.props, index),\n        });\n      });\n    }, [options, children, sequence, handleStatus]);\n\n    return (\n      <StepsContext.Provider value={{ current, theme, readonly, onChange }}>\n        <div\n          ref={ref}\n          style={style}\n          className={classnames({\n            [`${classPrefix}-steps`]: true,\n            [`${classPrefix}-steps--${theme}-anchor`]: theme,\n            [`${classPrefix}-steps--${layout}`]: layout,\n            [`${classPrefix}-steps--${sequence}`]: sequence,\n            [`${classPrefix}-steps--${separator}-separator`]: separator,\n            [props.className]: !!props.className,\n          })}\n        >\n          {stepItemList}\n        </div>\n      </StepsContext.Provider>\n    );\n  },\n  { StepItem },\n);\n\nSteps.displayName = 'Steps';\n\nexport default Steps;\n"],"names":["Steps","forwardRefWithStatics","originalProps","ref","props","useDefaultProps","stepsDefaultProps","style","readonly","layout","theme","sequence","separator","children","options","_useConfig","useConfig","classPrefix","_useControlled","useControlled","onChange","_useControlled2","_slicedToArray","current","indexMap","useMemo","map","forEach","item","index","value","React","Children","child","isValidElement","handleStatus","useCallback","_item$value","status","matchIndex","console","warn","key","stepItemList","optionsDisplayList","reverse","stepIndex","length","createElement","StepItem","_objectSpread","childrenList","toArray","childrenDisplayList","cloneElement","StepsContext","Provider","className","classnames","_defineProperty","concat","displayName"],"mappings":"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"}