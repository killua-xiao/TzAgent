{"version":3,"file":"BackTop.js","sources":["../../../components/back-top/BackTop.tsx"],"sourcesContent":["import classNames from 'classnames';\nimport React, { useCallback, useMemo } from 'react';\nimport { BacktopIcon } from 'tdesign-icons-react';\nimport useConfig from '../hooks/useConfig';\nimport { TdBackTopProps } from './type';\nimport { backTopDefaultProps } from './defaultProps';\nimport useScroll from './useScroll';\nimport { scrollTo } from '../_util/scroll';\nimport useDefaultProps from '../hooks/useDefaultProps';\n\nexport type BackTopProps = TdBackTopProps;\n\nconst getContainer = (container: string | Function) => {\n  if (typeof container === 'string') {\n    if (typeof document !== 'undefined') {\n      return document.querySelector(container);\n    }\n  }\n  if (typeof container === 'function') {\n    return container();\n  }\n  return null;\n};\n\nconst InternalBackTop: React.ForwardRefRenderFunction<HTMLButtonElement, BackTopProps> = (props, ref) => {\n  const {\n    theme,\n    size,\n    shape,\n    target,\n    visibleHeight,\n    container,\n    duration,\n    content,\n    offset,\n    children,\n    default: cusContent,\n    className,\n    style,\n    onClick,\n  } = useDefaultProps(props, backTopDefaultProps);\n  const { classPrefix } = useConfig();\n  const scrollContainer = useMemo(() => getContainer(container), [container]);\n  const { scrollTop } = useScroll({ target: scrollContainer });\n  const defaultContent = (\n    <>\n      <BacktopIcon className={`${classPrefix}-back-top__icon`} size={24} />\n      <span className={`${classPrefix}-back-top__text`}>TOP</span>\n    </>\n  );\n  const renderChildren = children || content || cusContent || defaultContent;\n\n  const backTopRef = React.useRef<HTMLButtonElement>(null);\n\n  React.useImperativeHandle(ref, () => backTopRef.current);\n\n  const visible = useMemo(() => {\n    if (typeof visibleHeight === 'string') {\n      return scrollTop >= Number(visibleHeight.replace('px', ''));\n    }\n    return scrollTop >= visibleHeight;\n  }, [scrollTop, visibleHeight]);\n\n  const backTopStyle = useMemo(\n    () => ({\n      insetInlineEnd: offset[0],\n      insetBlockEnd: offset[1],\n      ...style,\n    }),\n    [offset, style],\n  );\n\n  const cls = classNames(\n    `${classPrefix}-back-top`,\n    `${classPrefix}-back-top--theme-${theme}`,\n    `${classPrefix}-back-top--${shape}`,\n    {\n      [`${classPrefix}-back-top--show`]: visible,\n      [`${classPrefix}-size-s`]: size === 'small',\n      [`${classPrefix}-size-m`]: size === 'medium',\n    },\n    className,\n  );\n\n  const getBackTo = useCallback(() => {\n    if (!target) return 0;\n    const targetNode = getContainer(target);\n    if (!targetNode) return 0;\n    const rect = targetNode.getBoundingClientRect();\n    const { y } = rect;\n    return y;\n  }, [target]);\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n      e.stopPropagation();\n      onClick?.({ e });\n      const backTo = getBackTo();\n      scrollTo(backTo, { container: scrollContainer, duration });\n    },\n    [duration, getBackTo, onClick, scrollContainer],\n  );\n\n  return (\n    <button type=\"button\" ref={backTopRef} className={cls} style={backTopStyle} onClick={handleClick}>\n      {renderChildren}\n    </button>\n  );\n};\n\nconst BackTop = React.forwardRef<HTMLButtonElement, TdBackTopProps>(InternalBackTop);\n\nBackTop.displayName = 'BackTop';\n\nexport default BackTop;\n"],"names":["getContainer","container","document","querySelector","InternalBackTop","props","ref","_useDefaultProps","useDefaultProps","backTopDefaultProps","theme","size","shape","target","visibleHeight","duration","content","offset","children","cusContent","className","style","onClick","_useConfig","useConfig","classPrefix","scrollContainer","useMemo","_useScroll","useScroll","scrollTop","defaultContent","React","createElement","BacktopIcon","renderChildren","backTopRef","useRef","useImperativeHandle","current","visible","Number","replace","backTopStyle","_objectSpread","insetInlineEnd","insetBlockEnd","cls","classNames","concat","_defineProperty","getBackTo","useCallback","targetNode","rect","getBoundingClientRect","y","handleClick","e","stopPropagation","backTo","scrollTo","type","BackTop","forwardRef","displayName"],"mappings":"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"}