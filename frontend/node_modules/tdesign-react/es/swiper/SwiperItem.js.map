{"version":3,"file":"SwiperItem.js","sources":["../../../components/swiper/SwiperItem.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport classnames from 'classnames';\nimport useConfig from '../hooks/useConfig';\nimport { SwiperProps } from './Swiper';\nimport useIsFirstRender from '../hooks/useIsFirstRender';\n\nexport interface SwiperItemProps extends SwiperProps {\n  currentIndex?: number;\n  index?: number;\n  needAnimation?: boolean;\n  childrenLength?: number;\n  getWrapAttribute?: (attr: string) => number;\n}\n\nconst CARD_SCALE = 210 / 332; // 缩放比例\nconst itemWidth = 0.415; // 依据设计稿使用t-swiper__card控制每个swiper的宽度为41.5%\n\nconst disposeIndex = (index: number, currentIndex: number, childrenLength: number) => {\n  if (currentIndex === 0 && index === childrenLength - 1) {\n    return -1;\n  }\n  if (currentIndex === childrenLength - 1 && index === 0) {\n    return childrenLength;\n  }\n  if (index < currentIndex - 1 && currentIndex - index >= childrenLength / 2) {\n    return childrenLength + 1;\n  }\n  if (index > currentIndex + 1 && index - currentIndex >= childrenLength / 2) {\n    return -2;\n  }\n\n  return index;\n};\n\nconst calculateTranslate = (index: number, currentIndex: number, parentWidth: number, inStage: boolean) => {\n  if (inStage) {\n    return (parentWidth * ((index - currentIndex) * (1 - itemWidth * CARD_SCALE) - itemWidth + 1)) / 2;\n  }\n  if (index < currentIndex) {\n    return (-itemWidth * (1 + CARD_SCALE) * parentWidth) / 2;\n  }\n  return ((2 + itemWidth * (CARD_SCALE - 1)) * parentWidth) / 2;\n};\n\nconst getZindex = (isActivity: boolean, inStage: boolean) => {\n  if (isActivity) {\n    return 2;\n  }\n  if (inStage) {\n    return 1;\n  }\n  return 0;\n};\n\nconst SwiperItem: React.FC<SwiperItemProps> = (props) => {\n  const {\n    children,\n    currentIndex,\n    index,\n    animation,\n    duration = 300,\n    needAnimation,\n    type = 'default',\n    childrenLength,\n    getWrapAttribute,\n  } = props;\n  const { classPrefix } = useConfig();\n  const [, setUpdate] = useState({});\n  const isFirstFirstRender = useIsFirstRender();\n\n  const getSwiperItemStyle = (): React.CSSProperties => {\n    if (animation === 'fade') {\n      return {\n        opacity: currentIndex === index ? 1 : 0,\n        transition: needAnimation ? `opacity ${duration / 1000}s` : '',\n      };\n    }\n    if (type === 'card') {\n      const wrapWidth = getWrapAttribute('offsetWidth');\n      const translateIndex =\n        index !== currentIndex && childrenLength > 2 ? disposeIndex(index, currentIndex, childrenLength) : index;\n      const inStage = Math.round(Math.abs(translateIndex - currentIndex)) <= 1;\n      const translate = calculateTranslate(translateIndex, currentIndex, wrapWidth, inStage).toFixed(2);\n      const isActivity = translateIndex === currentIndex;\n      const zIndex = getZindex(isActivity, inStage);\n      return {\n        msTransform: `translateX(${translate}px) scale(${isActivity ? 1 : CARD_SCALE})`,\n        WebkitTransform: `translateX(${translate}px) scale(${isActivity ? 1 : CARD_SCALE})`,\n        transform: `translateX(${translate}px) scale(${isActivity ? 1 : CARD_SCALE})`,\n        transition: `transform ${duration / 1000}s ease`,\n        zIndex,\n      };\n    }\n    return {};\n  };\n\n  useEffect(() => {\n    if (isFirstFirstRender) {\n      setUpdate({});\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div\n      className={classnames(`${classPrefix}-swiper__container__item`, {\n        [`${classPrefix}-swiper__card`]: type === 'card',\n        [`${classPrefix}-is-active`]: index === currentIndex,\n        [`${classPrefix}-swiper__fade`]: animation === 'fade',\n      })}\n      style={getSwiperItemStyle()}\n      data-index={index}\n    >\n      {children}\n    </div>\n  );\n};\n\nSwiperItem.displayName = 'SwiperItem';\n\nexport default SwiperItem;\n"],"names":["CARD_SCALE","itemWidth","disposeIndex","index","currentIndex","childrenLength","calculateTranslate","parentWidth","inStage","getZindex","isActivity","SwiperItem","props","children","animation","_props$duration","duration","needAnimation","_props$type","type","getWrapAttribute","_useConfig","useConfig","classPrefix","_useState","useState","_useState2","_slicedToArray","setUpdate","isFirstFirstRender","useIsFirstRender","getSwiperItemStyle","opacity","transition","concat","wrapWidth","translateIndex","Math","round","abs","translate","toFixed","zIndex","msTransform","WebkitTransform","transform","useEffect","React","createElement","className","classnames","_defineProperty","style","displayName"],"mappings":"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"}