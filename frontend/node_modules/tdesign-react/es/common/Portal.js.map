{"version":3,"file":"Portal.js","sources":["../../../components/common/Portal.tsx"],"sourcesContent":["import React, { forwardRef, useMemo, useImperativeHandle } from 'react';\nimport { createPortal } from 'react-dom';\nimport { AttachNode, AttachNodeReturnValue } from '../common';\nimport { canUseDocument } from '../_util/dom';\nimport useConfig from '../hooks/useConfig';\nimport useIsomorphicLayoutEffect from '../hooks/useLayoutEffect';\n\nexport interface PortalProps {\n  /**\n   * 指定挂载的 HTML 节点, false 为挂载在 body\n   */\n  attach?: React.ReactElement | AttachNode | boolean;\n  /**\n   * 触发元素\n   */\n  triggerNode?: HTMLElement;\n  children: React.ReactNode;\n}\n\nexport function getAttach(attach: PortalProps['attach'], triggerNode?: HTMLElement): AttachNodeReturnValue {\n  if (!canUseDocument) return null;\n\n  let el: AttachNodeReturnValue;\n  if (typeof attach === 'string') {\n    el = document.querySelector(attach);\n  }\n  if (typeof attach === 'function') {\n    el = attach(triggerNode);\n  }\n  if (typeof attach === 'object' && attach instanceof window.HTMLElement) {\n    el = attach;\n  }\n\n  // fix el in iframe\n  if (el && el.nodeType === 1) return el;\n\n  return document.body;\n}\n\nconst Portal = forwardRef((props: PortalProps, ref) => {\n  const { attach, children, triggerNode } = props;\n  const { classPrefix } = useConfig();\n\n  const container = useMemo(() => {\n    if (!canUseDocument) return null;\n    const el = document.createElement('div');\n    el.className = `${classPrefix}-portal-wrapper`;\n    return el;\n  }, [classPrefix]);\n\n  useIsomorphicLayoutEffect(() => {\n    const parentElement = getAttach(attach, triggerNode);\n    parentElement?.appendChild?.(container);\n\n    return () => {\n      parentElement?.removeChild?.(container);\n    };\n  }, [container, attach, triggerNode]);\n\n  useImperativeHandle(ref, () => container);\n\n  return canUseDocument ? createPortal(children, container) : null;\n});\n\nPortal.displayName = 'Portal';\n\nexport default Portal;\n"],"names":["getAttach","attach","triggerNode","canUseDocument","el","document","querySelector","_typeof","window","HTMLElement","nodeType","body","Portal","forwardRef","props","ref","children","_useConfig","useConfig","classPrefix","container","useMemo","createElement","className","useIsomorphicLayoutEffect","_parentElement$append","parentElement","appendChild","call","_parentElement$remove","removeChild","useImperativeHandle","createPortal","displayName"],"mappings":";;;;;;;;;;;;;;;;;;;;AAmBgB,SAAAA,SAAAA,CAAUC,QAA+BC,WAAkD,EAAA;AACzG,EAAA,IAAI,CAACC,cAAA,EAAuB,OAAA,IAAA,CAAA;AAExB,EAAA,IAAAC,EAAA,CAAA;AACA,EAAA,IAAA,OAAOH,WAAW,QAAU,EAAA;AACzBG,IAAAA,EAAA,GAAAC,QAAA,CAASC,cAAcL,MAAM,CAAA,CAAA;AACpC,GAAA;AACI,EAAA,IAAA,OAAOA,WAAW,UAAY,EAAA;AAChCG,IAAAA,EAAA,GAAKH,OAAOC,WAAW,CAAA,CAAA;AACzB,GAAA;EACA,IAAIK,OAAA,CAAON,MAAA,CAAW,KAAA,QAAY,IAAAA,MAAA,YAAkBO,OAAOC,WAAa,EAAA;AACjEL,IAAAA,EAAA,GAAAH,MAAA,CAAA;AACP,GAAA;EAGI,IAAAG,EAAA,IAAMA,GAAGM,QAAa,KAAA,CAAA,EAAU,OAAAN,EAAA,CAAA;EAEpC,OAAOC,QAAS,CAAAM,IAAA,CAAA;AAClB,CAAA;AAEMC,IAAAA,MAAS,gBAAAC,UAAA,CAAW,UAACC,KAAA,EAAoBC,GAAQ,EAAA;AACrD,EAAA,IAAQd,MAAA,GAAkCa,KAAA,CAAlCb,MAAA;IAAQe,QAAU,GAAgBF,KAAA,CAA1BE,QAAU;IAAAd,WAAA,GAAgBY,KAAA,CAAhBZ,WAAA,CAAA;AACpB,EAAA,IAAAe,UAAA,GAAkBC,SAAU,EAAA;IAA1BC,WAAY,GAAAF,UAAA,CAAZE,WAAY,CAAA;AAEd,EAAA,IAAAC,SAAA,GAAYC,QAAQ,YAAM;AAC9B,IAAA,IAAI,CAAClB,cAAA,EAAuB,OAAA,IAAA,CAAA;AACtB,IAAA,IAAAC,EAAA,GAAKC,QAAS,CAAAiB,aAAA,CAAc,KAAK,CAAA,CAAA;AACvClB,IAAAA,EAAA,CAAGmB,sBAAeJ,WAAA,EAAA,iBAAA,CAAA,CAAA;AACX,IAAA,OAAAf,EAAA,CAAA;AACT,GAAA,EAAG,CAACe,WAAW,CAAC,CAAA,CAAA;AAEhBK,EAAAA,yBAAA,CAA0B,YAAM;AAAA,IAAA,IAAAC,qBAAA,CAAA;AACxB,IAAA,IAAAC,aAAA,GAAgB1B,SAAU,CAAAC,MAAA,EAAQC,WAAW,CAAA,CAAA;AACnDwB,IAAAA,aAAA,aAAAA,aAAA,KAAA,KAAA,CAAA,IAAA,CAAAD,qBAAA,GAAAC,aAAA,CAAeC,6DAAfF,qBAAA,CAAAG,IAAA,CAAAF,aAAA,EAA6BN,SAAS,CAAA,CAAA;AAEtC,IAAA,OAAO,YAAM;AAAA,MAAA,IAAAS,qBAAA,CAAA;AACXH,MAAAA,aAAA,aAAAA,aAAA,KAAA,KAAA,CAAA,IAAA,CAAAG,qBAAA,GAAAH,aAAA,CAAeI,6DAAfD,qBAAA,CAAAD,IAAA,CAAAF,aAAA,EAA6BN,SAAS,CAAA,CAAA;KACxC,CAAA;GACC,EAAA,CAACA,SAAW,EAAAnB,MAAA,EAAQC,WAAW,CAAC,CAAA,CAAA;EAEf6B,mBAAA,CAAAhB,GAAA,EAAK,YAAA;AAAA,IAAA,OAAMK,SAAS,CAAA;GAAA,CAAA,CAAA;EAExC,OAAOjB,cAAiB,gBAAA6B,YAAA,CAAahB,QAAU,EAAAI,SAAS,CAAI,GAAA,IAAA,CAAA;AAC9D,CAAC,EAAA;AAEDR,MAAA,CAAOqB,WAAc,GAAA,QAAA;;;;"}